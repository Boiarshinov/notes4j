---
title: "Protobuf"
tags:
  - formats
  - binary
draft: true
---

# Protobuf

**Protobuf** - бинарный формат представления данных, разработанный Google.

Важнейшей задачей при разработке формата была поддержка обратной совместимости при развитии модели сообщения.

Структура сообщения описывается с помощью файла с расширением `.proto`.

На данный момент (2021 г.) поддерживается две версии формата:
- proto2
- proto3

Создатели Protobuf уже не работают в Google и в рамках отдельного проекта выпустили дальнейшее развитие Protobuf - [Cap'n Proto](https://capnproto.org/).

## Типы

### Перечисления

Перечисления объявляются с помощью ключевого слова `enum`:
```proto
message MyMessage {

  Status status = 4;

  enum Status {
    UNKNOWN = 0;
    ACCEPTED = 1;
    DENIED = 2;
    IN_PROGRESS = 3;
  }
}
```
Значения перечисления должны обязательно начинаться с нуля.

При сериализации перечисления представляются в виде 32-битного целого числа (`int`).

Если поле перечисляемого типа не было заполнено при сериализации, то при десериализации в него будет записано первое объявленное значение.
Поэтому рекомендуется во всех своих перечислениях первым элементом объявлять значение с именем `UNKNOWN` или `UNEXPECTED`.

При удалении каких-либо значений из перечисления, чтобы избежать различных ошибок при дальнейшем развитии модели, следует заблокировать имя или номер удаленного перечисления:
```proto
enum Status {
  reserved 2;

  UNKNOWN = 0;
  ACCEPTED = 1;
  IN_PROGRESS = 3;
}
```


---
## К изучению
- [ ] [Документация](https://developers.google.com/protocol-buffers/docs/proto3)