---
title: "Часы"
tags:
  - time
draft: false
---

# Часы

Для разных задач в компьютерах используются разные виды часов:
- __часы реального времени__ - часы, которые могут использоваться для определения времени. 
  Например, чтобы узнать, что сейчас 10 марта 2038 года 15:34.
- __монотонные часы__ - часы, которые не имеют привязки к окружающему миру, а выражают просто течение времени.
  Такие часы используются для измерения времени прохождения каких-либо процессов, например, для измерения времени выполнения алгоритма.

Во многих примитивных электронных устройствах отсутствуют часы реального времени, а в качестве монотонных часов используется осциллятор.
Например, так выглядит работа со временем в Arduino.
Если в проекте на Arduino необходимо знать реальное время, то приходится подключать отдельные железки.

От часов в программах может зависеть большое количество процессов, поэтому правильное поведение часов - это очень ответственная задача.

Синхронизация часов реального времени очень важна в [распределенных системах](../architecture/distributed_systems_time.md).
Для синхронизации используется подстройка часов с помощью NTP или PTP протоколов.
Если часы системы слишком спешат, то при подстройке время может быть сброшено одним скачком, что будет восприниматься системой так, будто время пошло назад. 

---
## Монотонные часы

Монотонные часы гарантированно всегда идут только вперед.
Поэтому для измерения длительности проходящих процессов следует использовать именно их.
Одиночные показания монотонных часов бессмысленны.
Показания обретают смысл только при их сравнении.
То есть если мы снимем пару показаний и вычтем из одного другое.

В Java для получения показания монотонных часов используется метод
```java
long start = System.nanoTime();
```
Не стоит бояться переполнения знаковой переменной, т.к. при вычитании из одного показания другого будут все равно получаться осмысленные результаты.
```java
if (System.nanoTime() - start >= timeout) { /*...*/ }
```


---
## К изучению

- [ ] Книга. Martin Kleppmann. Designing data-intensive applications. Глава 8
