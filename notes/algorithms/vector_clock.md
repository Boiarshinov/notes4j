---
title: "Векторные часы"
tags: 
  - distributed_system
  - time
draft: false
---

# Векторные часы

Векторные часы - это развитие идей [часов Лэмпорта](lamport_clock.md).

Для реализации векторных часов необходимо, чтобы каждая нода хранила у себя массив (вектор) значений счетчиков всех остальных нод.

Когда в ноде происходит событие, инкрементируется значение счетчика данной ноды.
Если система отправляет сообщение о событии в другую ноду, то перед этим она инкрементирует счетчик своей ноды, а затем передает вместе с сообщением значения всех счетчиков.
Если система принимает сообщение от другой ноды, то она обновляет значения всех счетчиков, выбирая максимальное значение из двух, после чего инкрементирует значение своего счетчика.

### Свойства векторных часов
- Если значения всех счетчиков для двух событий совпадают, то они произошли одновременно (хотя скорее это означает, что это одно и то же событие).
- Событие А произошло раньше или одновременно с событием Б, если значения всех счетчиков события А меньше или равны значениям счетчика Б.
- Событие А произошло раньше события Б, если выполняется предыдущее условие и есть хотя бы один счетчик в А, значение которого меньше того же счетчика в Б.
- События конкурентны, если не прослеживается однозначного неравенства между всеми счетчиками

### Рассуждения
Что делать, если количество нод в кластере может меняться со временем?
В это случае вектор должен быть уже не массивом, а мапой, где ключ - уникальный идентификатор ноды, а значение - счетчик этой ноды.
При этом нужно уметь выкидывать из вектора данные по умершим нодам, чтобы он не пух от лишних данных.

---
## К изучению
- [X] [Wiki](https://ru.wikipedia.org/wiki/%D0%92%D0%B5%D0%BA%D1%82%D0%BE%D1%80%D0%BD%D1%8B%D0%B5_%D1%87%D0%B0%D1%81%D1%8B)
- [X] [4 лекция](https://www.youtube.com/watch?v=x-D8iFU1d-o&list=PLeKd45zvjcDFUEv_ohr_HdUFe97RItdiB&index=11&ab_channel=MartinKleppmann) курса по распределенным системам от Мартина Клеппманна