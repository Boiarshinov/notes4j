---
title: "Агрегатные функции"
tags:
  - database
  - sql
draft: false
---

# Агрегатные функции

Агрегатные функции:
- `SUM(atribute)` - возвращает сумму всех значений атрибута. Работает только с числовыми атрибутами
- `MIN(atribute)` - возвращает минимальное из всех значений переданного атрибута
- `MAX(atribute)` - возвращает максимальное из всех значений переданного атрибута
- `AVG(atribute)` - возвращает среднее по значениям переданного атрибута. Работает только с числовыми атрибутами
- `COUNT( [DISTINCT] atribute)` - возвращает количество записей атрибута (NULL не считается)
- `COUNT(*)` - возвращает общее количество записей в таблице

Аргумент агрегатной функции не может содержать в себе другой агрегатной функции 😞 Но можно взять агрегатную функцию от результата выборки по другой агрегатной функции:
```sql
SELECT MAX(avg_price)
FROM (SELECT AVG(price) as avg_price FROM
    products GROUP BY maker);
```

По таким функциям может работать группировка `GROUP BY`. То есть группировка заставляет агрегатные функции работать не со всеми кортежами, а с группами, сформированными с помощью `GROUP BY`. Соответственно в результате может быть более одного кортежа.

## Фильтрация по значению агрегатной функции

Фильтрация производится с помощью ключевого слова `HAVING`, записанного после `GROUP BY`

```sql
SELECT model, AVG(price) FROM cars
GROUP BY model
HAVING AVG(price) > 10000;
```