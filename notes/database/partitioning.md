---
title: "Партиционирование"
tags:
  - database
draft: false
---

# Партиционирование

Стандарт SQL не устанавливает каким образом данные должны храниться на диске.
Поэтому различные СУБД вольны делать это по-своему.
Чаще всего информация по каждой таблице пишется в отдельный файл.
Если таблица получается очень большая, то файл вырастает до таких размеров, что с ним становится неудобно работать.
Поэтому многие СУБД предоставляют возможность партиционирования.

__Партиционирование__ - это разбиение хранимых данных на несколько единиц хранения (файлов).
Партиционирование позволяет:
- удалять старые партиции, если данные уже устарели и не нужны;
- хранить большие объемы данных, которые не поместились бы в файловую систему одним куском;
- ускорить запросы по ключам, на которых построено партиционирование, т.к. запрос будет выполняться только на части данных.

---
## MySQL
В MySQL партиционирование всегда горизонтальное, то есть проводится по строкам, а не по колонкам.

При вставке новой записи нужно выбрать партицию, в которую будет произведена запись.
Выбор партиции делается с помощью __функции партиционирования__.
Эта функция принимает значения колонок вставляемой записи, на основе которых производится расчёт, и возвращает номер партиции.

В MySQL партиционирование бывает нескольких видов:
- Range - вхождение значения выбранной колонки в интервал значений. Хорошо подходит для партиционирования по времени
- List - вхождение значения выбранной колонки в список значений
- Hash - можно задать выражение, вычисляющее целочисленное значение из колонок вставляемой записи
- Key - то же, что и Hash, только еще используется встроенная в MySQL хэш-функция

При партиционировании важно помнить о следующем ограничении:
> Все колонки, использующиеся для партиционирования, должны быть частью всех уникальных ключей таблицы (в том числе первичного ключа).

```sql
CREATE TABLE my_table (
  id         bigint AUTOINCREMENT, 
  col        text                                not null, 
  created_at timestamp default CURRENT_TIMESTAMP not null,
  primary key(id, created_at)
)
PARTITION BY RANGE( UNIX_TIMESTAMP(created_at) ) (
  PARTITION p0 VALUES LESS THAN ( UNIX_TIMESTAMP('2008-01-01 00:00:00') ),
  PARTITION p1 VALUES LESS THAN ( UNIX_TIMESTAMP('2008-04-01 00:00:00') ),
  PARTITION p2 VALUES LESS THAN (MAXVALUE)
);
```

---
## К изучению
- [ ] [Документация MySQL. Партиционирование](https://dev.mysql.com/doc/refman/5.7/en/partitioning.html)
