---
title: "PostgreSQL"
tags:
  - database
  - sql
draft: false
---

# PostgreSQL

PostgreSQL - это реляционная СУБД.

В PostgreSQL есть свое собственное понятие __Кластер__, которое отличается от терминологии [распределенных систем](../architecture/distributed_systems.md).
Кластер - это набор схем баз данных, находящихся на одном сервере PostgreSQL.

Чаще всего PostgreSQL ставятся на сервера под управлением ОС Linux и потому установить PostgreSQL можно с помощью пакетного менеджера.
При этом устанавливается только серверное приложение без какой-либо GUI оболочки.

Файловое устройство:
- `/usr/lib/postgresql/version/bin` - утилиты postgres
- `/usr/lib/postgresql/version/lib` - 
- `/var/lib/postgresql/version/main` - именно здесь лежат данные. Название каталога 'main' может отличаться, т.к. это название кластера схем баз данных. По умолчанию это 'main'. Данные в этом каталоге должны принадлежать пользователю 'postgres' и иметь права '0700' или '0750'.
- `/var/log/postgresql` - логи
- `/etc/postgresql/version/main` - файлы конфигурации


## Утилиты postgresql

Вместе с postgresql идет ряд утилит, которые располагаются в директории `/usr/lib/postgresql/version/bin`.
Вот часть из них:
- `initdb` - создает кластер БД. При инициализации рекомендуется задать имя суперпользователя (обычно это 'postgres'), либо вызывать ее от имени пользователя postgres. При установке PostgreSQL с помощью пакетного менеджера эту утилиту вызывать не требуется, т.к. она будет вызвана автоматически.
> initdb -U postgres -k -D path/to/postgresql/data
- `pg_ctl` - (postgres control) управляет состоянием инстанса Postgres: позволяет запускать, останавливать, узнавать статус сервера, обновлять конфигурацию и т.д.
> pg_ctl start -l /path/to/log/dir
- `psql` - позволяет общаться с сервером с помощью стандартного SQL-синтаксиса. Утилита очень богатая и требует отдельного раздела для описания.
> psql -d schema -U postgres
- `pg_config` - данные о дистрибутиве
- `pg_ctlcluster` - обертка над pg_ctl, распространяющаяся в пакетных сборках postgres


## Конфигурация

Конфигурация инстанса postgresql находится в файлах директории `/etc/postgresql/version/main`.
Для того, чтобы сервер подтянул изменения, необходимо перечитать конфигурацию (`reload`), но для некоторых изменений требуется полная перезагрузка postgres.

Конфигурационные файлы:
- `postgresql.conf` - основной файл конфигурации
- `pg_hba.conf` - hba означает host based authentication
- `pg_ident.conf` - 
- `postgresql.auto.conf` - конфигурационный файл с тем же наполнением, что и `postgresql.conf`, но его можно редактировать с помощью SQL-команд `alter system`. Лежит в каталоге `/var/lib/postgresql/version/main`. Значения имеют приоритет над значениями из `postgresql.conf`. Этот файл предназначен для того, чтобы админы могли менять настройки сервера с помощью удаленного подключения по psql.



## Системные таблицы
- `pg_tables` - все таблицы всех схем
- `pg_settings` - настройки сервера postgres


---
## К изучению

- [ ] [Учебный видеокурс "Администрирование PostgreSQL"](https://www.youtube.com/playlist?list=PLaFqU3KCWw6LPcuYVymLcXl3muC45mu3e)
