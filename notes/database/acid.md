---
title: "ACID"
tags:
  - database
draft: false
---

# ACID

ACID - это акроним, описывающий требования к [транзакциям](transactions.md)

- Atomicity - Атомарность
- Consistency - Консистентность / Согласованность
- Isolation - Изолированность
- Durability - Стойкость

ACID предъявляет требования не только к СУБД (хотя к ним в первую очередь), но и к любым системам, работающим с транзакциями.

Существует много критики аббревиатуры ACID, утверждающей, что буквы C и D в ней лишние.

Многие NoSQL базы данных, которые не поддерживают требования ACID, заявляют, что они удовлетворяют другим требованиям - [BASE](base.md).

### Atomicity

Атомарность предъявляет требования к тому чтобы каждая транзакция не могла быть зафиксирована частично. 
Это требование устанавливает требования к роллбэку частично выполнившихся транзакций.

В многопоточке атомарными операциями называют такие операции, промежуточный результат работы которых не виден другим потокам исполнения.
В базах данных такое свойство называется изоляцией, а не атомарностью. 

В СУБД атомарность реализуется с помощью журнала операций. 
Все операции перед записью в базу записываются сначала в журнал, если транзакция будет прервана, то записи из журнала не накатываются на базу.

### Consistency

После выполнения транзакции данные в БД должны быть согласованными. 
Другими словами не должны нарушаться какие-либо ограничения.

### Isolation

Параллельно выполняющиеся транзакции не должны оказывать влияния на другие транзакции.

Этот принцип самый сложноосуществимый из-за возможных дедлоков, состояний гонки и других [Проблем многонитевости](../java/multithreading/concurrency_problems.md).

### Durability

Для серверов БД в единичном экземпляре, требование durability означает, что при успешно завершенной транзакции данные должны быть сохранены и быть устойчивыми к, например, отключению электричества.

Но для реплицируемых БД требования усиливаются.
В реплицируемой БД при успешно завершенной транзакции данные должны быть отреплицированы на другой сервер, чтобы при выходе из строя мастер-ноды данные не были потеряны.

Не очень понятно, что требования к сохраняемости делают в требованиях к транзакциям, т.к. обычно в БД за транзакции отвечает транзакционный менеджер, а за хранение и репликацию совсем другие механизмы.

---
## Уровни изоляции

todo

---
## Аномалии изоляции

//дописать. См. последнюю ссылку

### Dirty Read - Грязное чтение

Транзакция А изменяет данные, в это время транзакция Б их считывает. Внезапно транзакция А откатывается. В результате транзакция Б воспользовалась незакоммиченными данными, что ведет к потенциальной ошибке в работе приложения.

### Non-Repeatable Read - Неповторяющееся чтение

Транзакция А считала какие-то данные, в это время транзакция Б модифицировала эти данные и закоммитилась. Транзакция А в ходе выполнения снова производит чтение тех данных и получает несовместимость данных.

### Phantom Read - Фантомное чтение

Транзакция А сделала выборку по каким-либо данным, в это время транзакция Б добавила в БД запись, подходящую под условия выборки. Транзакция А делает повторную выборку по тем же данным и получает другое количество записей.

---
## К изучению
- [X] Вики: https://ru.wikipedia.org/wiki/ACID
- [X] Краткий обзор и критика ACID: https://habr.com/ru/company/otus/blog/494652/
- [ ] Про ACID еще раз и про Саги: https://habr.com/ru/company/avito/blog/426101/
- [ ] Про аномалии изоляции: https://habr.com/ru/company/otus/blog/501294/
- [ ] М. Клеппманн. Data intensive applications. Глава 7 - Транзакции