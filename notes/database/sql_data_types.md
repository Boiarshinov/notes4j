---
title: "Типы данных"
tags:
  - database
  - sql
draft: false
---

# Типы данных

## Числовые типы данных

Общие для всех СУБД типы:
- Целые: форма записи - `INT[(M)] [UNSIGNED] [ZEROFILL]`
    - `SMALLINT` - 2 байта
    - `INT` (синоним - `INTEGER`) - 4 байта
    - `BIGINT` - 8 байт
- Вещественные: форма записи - `DOUBLE[(M, D)] [UNSIGNED] [ZEROFILL]`
    - `FLOAT` - устанавливает количество знаков перед и после запятой
    - `REAL` - тип float с предустановленной точностью. Занимает 34 бита.
    - `DOUBLE PRECISION` - real с двойной точностью. Занимает 64 бита.
    - `DECIMAL` - число с более чем 500 символами, хранится как строка. Не подходит, если нужно совершать арифметические операции прямо в запросе
    - `NUMERIC` - аналог `DECIMAL`

```sql
FLOAT(3) /* 3 знака после запятой */
DECIMAL(3, 4) /* 3 знака перед запятой и 4 после */
```

Дополнительные модификаторы:

- `(M)` - ограничивает количество символов, которые могут быть указаны. Не экономит память!
- `(M, D)` - `M` - количество знаков, `D` - количество разрядов за десятичной точкой
- `UNSIGNED` - беззнаковый формат. По умолчанию он не указан
- `ZEROFILL` - заполняет нулями неизрасходованные позиции в числе. Позволяет восстановить большое количество данных при сбое, из-за отсутствия фрагментации данных


---
## Временные типы

### Стандартные типы

- `DATE` - ГГГГ-ММ-ДД
- `TIME` - ЧЧ:ММ:СС - время дня без метки часового пояса
- `TIMESTAMP[(M)]` - ГГГГ-ММ-ДД ЧЧ:ММ:СС - не хранит временную метку часового пояса. Далее актуально для MySQL: //Противоречит документации MySQL. Число в скобках означает количество знаков после запятой для секунд
    - M = 6 - ГГГГММ
    - М = 8 - ГГГГММДД
    - М = 10 - ГГГГММДДЧЧ
    - М = 12 - ГГГГММДДЧЧММ
    - М = 14 - ГГГГММДДЧЧММСС

`TIMESTAMP` хорош тем, что может при создании новых строк в таблице или при их апдейте автоматически принимать текущее значение времени:
```sql
CREATE TABLE table_name (
    ...
    time_of_last_update TIMESTAMP ON UPDATE CURRENT_TIMESTAMP); /* Значение будет устанавливаться автоматически при апдейте */
```

В MySQL `TIMESTAMP` может принимать значения только от 1970 г. до 2038 г., что делает его неподходящим кандидатом для хранения данных о датах рождения, астрономических событиях и проч.


### Дополнительные типы MySQL

- `datetime` - ГГГГ-ММ-ДД ЧЧ:ММ:СС - хранит временную метку часового пояса, что выгодно отличает его от timestamp.
- `year[(2 | 4)]`
    - 2-значный формат - от 1970 до 2036
    - 4-значный формат - сколько хочешь

### Дополнительные типы PostgreSQL

Дополнительные типы PostgreSQL:

- `timestamp with time zone (timestamptz)` - `timestamp` с меткой временного пояса. Занимает 8 байт.
- `time with time zone` - время дня с часовым поясом. Занимает 12 байт.
- `interval`

---
## Строки

- `CHAR(M)` - Строка фиксированной длины. Если при вставке была передана строчка длиной меньше указанной, то она дополняется до указанной длины пробелами справа. При извлечении из БД пробелы обрезаются. Максимальная длина - 256 символов. Эффективнее хранится и обрабатывается, чем VARCHAR.
- `VARCHAR(M)` - Строка переменной длины. Максимальная длина 2^16 символов.
- `TEXT` - Строка неограниченной длины (в некоторых БД имеет максимальный размер). Как правило, размер ограничивается максимальной физической памятью, например, 1 ГБ.

### MySQL
В Mysql тип `TEXT` ограничен длиной в 2^16 символов. 
При этом колонки типа `TEXT` не могут использоваться в качестве индекса.

### PostgreSQL
В PostgreSQL тип `CHAR` работает медленнее других типов и не рекомендуется к использованию.

---
## Логические типы

В стандарте SQL определен только один логический тип данных:
- `BOOLEAN` - истина или ложь

### MySQL

В MySQL не существует типа `BOOLEAN`. При попытке создания колонки такого типа `BOOLEAN` будет преобразован в `tinyint(1)`.

### PostgreSQL
В PostgreSQL значение `BOOLEAN` занимает 1 байт.

---
## Данные

Обычно данные предпочитают хранить не в БД, а в файловой системе, при этом в БД указывать только путь до файла. Но иногда имеет смысл запихнуть в БД бинарник, в таком случае можно использовать один из следующих форматов:

- `BLOB` - binary large object
- `CLOB` - character large object

---
## Перечисления

Перечисления используются в тех случаях, когда для поля существует строго определенное количество известных состояний. Перечисления позволяют обеспечить типобезопасность записываемых данных, уберегая от опечаток.

### MySQL

В MySQL перечисление объявляется как тип колонки при создании таблицы, там же объявляются допустимые значения.
```sql
create table <table_name> (<column_name> ENUM(<enum_val1>, <enum_val2>, ...));
```

### PostgreSQL

В PostgreSQL объявление перечисления производится с помощью команды
```sql
create type <type_name> as enum (<value1>, <value2>, ...);
```
Все перечисления хранятся в схеме в директории `object types`.

---
## К изучению
- [X] [Список типов данных в ANSI SQL](https://dba.stackexchange.com/questions/53317/databases-are-there-universal-datatypes)
- [X] [Числа в SQL](https://learnsql.com/blog/understanding-numerical-data-types-sql/)
- [ ] [Типы данных в MySQL](https://dev.mysql.com/doc/refman/8.0/en/data-types.html)
- [ ] [Типы данных в PostgreSQL](https://postgrespro.ru/docs/postgresql/11/datatype)