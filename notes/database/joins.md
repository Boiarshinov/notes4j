---
title: "Запросы из нескольких таблиц"
tags:
  - database
  - sql
draft: false
---

# Запросы из нескольких таблиц

![Join types](../../images/joins.jpg)

## Пересечения таблиц

- [Декартово произведение](https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D1%8F%D0%BC%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B8%D0%B7%D0%B2%D0%B5%D0%B4%D0%B5%D0%BD%D0%B8%D0%B5) - `CROSS JOIN`

Простыми словами: произведение каждого элемента одного множества с каждым элементом другого множество.

Количество строк в декартовом произведении двух таблиц будет равно произведению количества строк одной и другой таблицы.
```sql
SELECT * FROM имя_таблицы_1 CROSS JOIN имя_таблицы_2;
```

- Внутреннее соединение - `INNER JOIN`

Тета-соединение - это результат выполнения декартового произведения без кортежей, которые не удовлетворяют какому-то условию. Условие записывается после ключевого слова `ON`
```sql
SELECT * FROM имя_таблицы_1 INNER JOIN имя_таблицы_2 ON имя_таблицы_1.атрибут_1 = имя_таблицы_2.атрибут_1;
```

- Левое и правое внешнее соединение - `LEFT OUTER JOIN` и `RIGHT OUTER JOIN`
- Полное внешнее соединение - `FULL OUTER JOIN`. В MySQL полное соединение не поддерживается.
- Естественное соединение -

Слова `INNER` и `OUTER` можно опускать, потому что понятно, что если указано `LEFT`, `RIGHT` или `FULL`, то это точно `OUTER JOIN`, а если этих слов нет, то это точно `INNER JOIN`.

<mark>//написать про неявный join</mark>

### Разница между ON и WHERE

С точки зрения полученной выборки в случае с `INNER JOIN` разницы не будет. Разница заключается во времени отбрасывания кортежей, неудовлетворяющих условию. В случае с `ON` кортежи неудовлетворяющие условию отбрасываются при перемножении таблиц, а в случае с `WHERE` фильтрация кортежей происходит после пересечения таблиц.

Зачастую разницы в скорости выполнения запросов отличающихся только `WHERE` и `ON` не будет, благодаря *планировщику запросов*, который оптимизирует запрос так, чтобы он выполнялся за минимальное время.

Все же рекомендуется при пересечении таблиц пользоваться оператором ON, потому что с его помощью можно отделить логику пересечения таблиц от логики, последующей фильтрации результатов пересечения.

---
## Объединение

Объединение двух выборок происходит с помощью оператора UNION. При этом типы данных атрибутов двух выборок должны совпадать (имена могут не совпадать):
```sql
SELECT * FROM product WHERE price > 900
UNION
SELECT * FROM product WHERE price < 100;
```

---
## Пересечение

Пересечение производится с помощью оператора `INTERSECT`
```sql
SELECT * FROM table
    WHERE atribut = value_1
INTERSECT
SELECT * FROM table
    WHERE atribut = value_2;
```

---
## К изучению

- [X] Разница между ON и WHERE: https://dataschool.com/how-to-teach-people-sql/difference-between-where-and-on-in-sql/