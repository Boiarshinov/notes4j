---
title: "Backup and Dump"
tags:
  - database
  - sql
draft: false
---

# Backup and Dump

__Backup__ снепшот состояния базы данных на конкретный момент времени.
Бэкапы бывают двух типов:
- Физический - копия файлов базы данных
- Логический - набор DDL и DML выражений, исполнение которых приведет базу данных к искомому состоянию. Такой тип бэкапа так же называется Дампом (__Dump__).

Физические бэкапы хороши в тех случаях, когда необходимо быстро восстановить состояние базы взамен сломанной.
Также создание такого бэкапа происходит намного быстрее, чем логического.
Сделать физический бэкап не так то просто.
Нельзя просто взять и скопировать файлы базы данных, т.к. эти файлы постоянно обновляются.
Поэтому физические бэкапы обычно делают на реплике, останавливая ее на время бэкапа.
Либо пользуются специальными утилитами.

Дампы хороши, когда требуется перенести небольшой объем данных из одной базы в другую.
Например, для заполнения баз тестовых стендов с помощью информации с прода.
Также дампы полезны, если необходимо как-либо изменить данные перед их применением к базе. 
Например, удаление чувствительных данных, изменение конфигурационных таблиц, и т.д.


---
## MySQL

В MySQL для снятия дампов используется утилита `mysqldump`.
Вывод из команды можно направить в файл.
```shell
mysqldump --all-databases --user root --password passwd > /tmp/dump.sql
```

Чтобы восстановить базу из дампа достаточно внутри mysql-cli выполнить команду
```shell
source /tmp/dump.sql
```

Для снятия физического бекапа необходимо остановить базу, либо перевести ее в режим read-only, после чего скопировать все файлы.
```shell
systemctl stop mysqld.service
cp -R /var/mysql/data /tmp/mysql/backup-2023-07-26
```

В MySQL существует возможность снятия бэкапов и с master-ноды на горячую (без остановки базы), но только в Enterprise версии.


---
## К изучению
- [X] [Backup для MariaDB. Видео.](https://www.youtube.com/watch?v=qoR2GaJmi8s&ab_channel=ShawnPowers) 20:47
- [X] [Документация MySQL. Общие положения](https://dev.mysql.com/doc/refman/8.0/en/backup-types.html)
- [X] [Документация MySQL. Создание бэкапов](https://dev.mysql.com/doc/mysql-backup-excerpt/5.7/en/replication-solutions-backups.html)