---
title: "JPA Конвертеры"
tags:
  - java_and_db
  - jpa
draft: false
---

Многие Java-типы с помощью ORM могут отображаться на типы данных БД автоматически. Об этих типах можно прочитать тут: [JPA. Соответствие типов](jpa_type_matching.md).

Но зачастую стандартных типов данных не хватает.

JPA Конвертеры предназначены для перевода объектов пользовательских классов в типы, понимаемые ORM.

Конвертеры позволяют хранить в сущности поля бизнес-типов вместо большого количества строк. Например, телефонный номер, ИНН и состояние сущности лучше хранить в бизнес-типах вместо строк.

Для того чтобы создать конвертер, нужно реализовать интерфейс `AttributeConverter`. Интерфейс является обобщенным, в нем нужно указать два класса: конвертируемый и тот класс, который может быть записан в БД (чаще всего String). В классе необходимо реализовать два метода: один для перевода из пользовательского класса в класс БД, другой для обратного перевода. Эти методы будут автоматически вызываться реализацией JPA при операциях с сущностью.

```java
@Converter
public class PhoneJpaConverter implements AttributeConverter<Phone, String> {
    @Override
    public String convertToDatabaseColumn(final Phone phone) {
        return phone.rawFormat(Phone.Format.NO_COUNTRY_CODE);
    }

    @Override
    public Phone convertToEntityAttribute(final String phoneString) {
        return Phone.of(phoneString);
    }
}
```

Над классом ставится аннотация `@Converter`.

В этой аннотации можно задать значение атрибута `autoApply` (по умолчанию false). Если он будет иметь значение true, то конвертер будет использоваться для конвертации всех полей указанного типа автоматически - без необходимости установки над ней аннотации, про которую написано ниже.

Я считаю, что менять `autoApply` не нужно. Разработчик, который будет читать код, должен сразу видеть существование конвертера и иметь возможность из поля сущности перейти к коду этого конвертера.

Над полем конвертируемого типа ставится аннотация `@Convert` с указанием класса конвертера
```java
@Convert(converter = PhoneJpaConverter.class)
private Phone phone;
```

Таким образом можно задать в различных сущностях разные конвертеры для одинаковых типов.

Помимо атрибута `converter` в аннотации определен еще атрибут `disableConversion`, который позволяет отключить конвертацию для данного поля, если в конвертере включено `autoApply`.

Атрибут `attributeName` используется, когда нужно указать конвертер для какого-либо embedded класса. Подробнее об использовании - в javadoc.

---
## К изучению

- [X] Документация на пакет `javax.persistence` в части касающейся
- [X] Статья на Baeldung: https://www.baeldung.com/jpa-attribute-converters