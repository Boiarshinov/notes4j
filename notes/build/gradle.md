---
title: "Gradle"
tags:
draft: false
---

## Общие сведения

Gradle - сборщик и менеджер зависимостей для Java проектов. Является аналогом Maven. Описание процесса сборки проводится с помощью языков Groovy или Kotlin.

Gradle работает быстрее Maven благодаря различным фичам, позволяющим не выполнять различные задачи, которые выполнялись ранее.

Запуск задач Gradle можно производить с помощью IDE или CLI.

Для отслеживания состояния билдов в Gradle есть специальный инструмент build scans.

Сборка проекта осуществляется в директорию `build`.

Gradle предоставляет возможно создавать различные задачи - таски и выстраивать их в графы зависимостей.

О тасках ниже.

Главный файл, аналог pom.xml, в Gradle это `build.gradle`

Стандартные глобальные переменные

- `project` - инстанс проекта
- `projectDir` - директория проекта
- `buildDir` - директория, в которую помещаются class-файлы и др. файлы, создающиеся при сборке проекта. Аналог `project.build.directory` из Maven.
- `path` - абсолютный путь к проекту

---
## Таски

Таска - это какая-то работа, например компиляция каких-либо файлов, генерация документации или создание jar.

Зависимости между тасками выражаются с помощью различных ключевых слов

- `dependsOn` - для выполнения таски требуется предварительное выполнение другой таски
```groovy
test.dependsOn classes // таска test требует предварительного выполнения таски classes
```

- `mustRunAfter` - жестко устанавливает порядок выполнения двух тасок. При этом таски могут вызываться независимо друг от друга.
```groovy
task2.mustRunAfter task1 //при вызове двух тасок вторая всегда будет выполняться после первой
```

- `shouldRunAfter` - указывает Gradle, что таски желательно выполнять в указанном порядке.
```groovy
task2.shouldRunAfter task1 //при вызове двух тасок вторая чаще будет выполняться после первой
```

- `finalizedBy` - после выполнения данной таски должна быть выполнена другая таска
```groovy
task1.finalizedBy task2 //при вызове первой таски всегда будет выполнена вторая таска
```

### Отключение тасок

Самый простой способ не выполнять таску - выключить ее с помощью параметра `enabled`
```groovy
task1.enabled = false
```

Вызов таски может производиться только при удовлетворении какого-либо условия. Записывается это с помощью метода таски `onlyIf` в который необходимо передать предикат

```groovy
task1.onlyIf { !project.hasProperty('skipTask1') }
```

### Выполнение кода в тасках

![gradle_default_tasks_dependencies](https://miro.medium.com/max/3336/1*E5JMRbW525OHTa1Op7dGGA.png)

На любой таске можно вызывать методы `doLast` и `doFirst`, исполняя какой-либо код.

<mark>//вставить код</mark>

### Параметры тасок

В таски можно добавлять параметры, которые будут доступны во всех местах, где эта таска вызывается. Делается это с помощью
```groovy
`ext`.
task taskName {
    ext.taskParam = "value"
}

task print {
    doLast {
        println taskName.taskParam
    }
}
```

### Результаты выполнения тасок

При запуске тасок в консоль выводятся результаты их выполнения:

- Нет примечания или `EXECUTED` - таска выполнена
- `UP-TO-DATE` - таска не выполнялась, потому что входные данные не изменились, а выходные уже были получены ранее
- `FROM-CACHE` - результаты выполнения таски были получены из кэша
- `SKIPPED` - таска не выполнялась, т.к. была намерено пропущена с помощью параметров запуска билда.
- `NO-SOURCE` - таска не выполнялась, потому что в ней отсутствовал код для исполнения

---
## Command Line Interface

Любые таски Gradle можно запускать из командной строки.

По умолчанию gradle создает в проекте исполняемый файл `gradlew`, который позволяет запускать таски без установки gradle на компьютер.
```groovy
./gradlew build -q
```

Ключ `-q` отключает вывод в командную строку логов, оставляя только то, что выводят в консоль таски.

---
## К изучению
- [ ] Документация на Gradle: https://docs.gradle.org/current/userguide/getting_started.html