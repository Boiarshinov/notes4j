---
title: "Сборка проектов - Maven"
tags:
draft: false
---

Для того чтобы собрать проект в один исполняемый файл используют специальные сборщики проектов, один из которых - **Maven**.

Apache Maven - (идиш - Собиратель знаний) инструмент для сборки проекта и управления зависимостями.

Каждый проект характеризуется тремя параметрами:
- `groupId` - namespace в котором объявлен проект. Обычно используется обратное DNS-имя компании, в которой разрабатывается продукт
- `artifactId` - название продукта (артифакта). Артефактом называется библиотека или готовый проект, который можно подключить к своему проекту. Например, JDBC или JUnit являются артифактами.
- `version` - версия продукта.

Версии продукта, находящегося в разработке, обозначают с припиской -SNAPSHOT.

Для работы Maven использует файл `pom.xml`, в котором прописываются для него следующие понятия:
- зависимости - подключаемые сторонние библиотеки, API которых используется в проекте.
- плагины - библиотеки, которые использует Maven исключительно для сборки проекта.

Также в `pom.xml` прописывается в какой архив Maven будет собирать приложение:
- `.jar` - для десктопных приложений
- `.war` - для web-приложений

---
## Создание Maven-проекта

*Archetype* - архетип - предопределенная структура проекта, которую можно использовать в качестве шаблона при создании нового Maven-проекта.

*GroupId* - должно быть уникальным. Прописывается также, как название пакетов - com.artybor.projects

*ArtifactId* - название проекта. Записывается с маленькой буквы, между словами ставится дефис.

---
## Структура Maven-проекта:
Структура Maven-проекта зависит от архетипа, но по умолчанию она следующая:

- `src`
    - `main`
        - `java` - здесь должен содержится весь java-код
        - `resourses` - тут должны быть все статические файлы - html, css, xml, properties и т.д.
    - `test` - для модульных JUnit тестов
        - `java`
- `pom.xml`- файл, в котором описываются зависимости. POM - Project Object Model

---
## Зависимости

Зависимости в Maven прописываются внутри тегов `<dependencies></dependencies>`.

Для того чтобы подключить зависимость, нужно зайти на [сайт-репозиторий Maven](https://mvnrepository.com/), найти интересующий артефакт и скопировать код в файл pom.xml в раздел dependecies
```xml
<dependecies>
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>6.0.6</version>
    </dependency>

    <!-- тут могут быть другие зависимости -->
</dependecies>
```

## Область видимости зависимости

К каждой зависимости может быть приписан такой необязательный элемент, как `<scope>`
- `compile` - зависимость используется только при компиляции и не будет включена в jar (war).
- `runtime` - зависимость не нужна при компиляции, но требуется при работе приложения.
- `provided` - зависимость не будет добавлена в jar (war). Такая область видимости прописывается, если необходимые классы предоставляются, например, веб-сервером.
- `test` - зависимость используется только на этапе тестирования.

---
## Плагины

Плагины в Maven прописываются внутри тегов `<plugins></plugins>`, которые в свою очередь оборачиваются в теги `<build></build>` и `<pluginManagement></pluginManagement>`.

При использовании Maven по умолчанию для сборки будет использоваться компилятор версии 1.6. Для того чтобы поменять его на более современные версии можно либо покопаться в настройках (но они могут слетать при выходе из IDEA), либо прописать в pom-файле следующее:

```xml
<build>
    <pluginManagement>
        <plugins>
            <plugin>
                <groupId>org.apache.maven.plugins</groupId>
                <artifactId>maven-compiler-plugin</artifactId>
                <version>3.8.1</version>
                <configuration>
                    <source>8</source>
                    <target>8</target>
                    <encoding>UTF-8</encoding>
                </configuration>
            </plugin>
        </plugins>
    </pluginManagement>
</build>
```
В source и target указывается необходимая версия Java.

---
## Жизненный цикл Maven

Основные этапы жизненного цикла:
- `validate` - проверка валидности файла pom.xml
- `compile` - компиляция
- `test` - тестирование c помощью тестового фреймворка
- `package` - создание jar или war
- `verify` - тестирование с помощью интеграционных тестов
- `install` - копирует jar или war в локальный репозиторий (в папку .m2)
- `deploy` - публикация приложения (jar или war) на удаленный репозиторий

При разработке приложения существует возможность дойти только до определенного этапа жизненного цикла. При этом будут выполнены и все предыдущие этапы.

Отдельно стоят следующие этапы:
- `clean` - удаляет все ранее скомпилированные классы
- `site` - создает документацию

Их необходимо вызывать отдельно.

---
## Репозитории

Репозитории в Maven бывают трех типов:
- Локальный репозиторий - все артефакты по умолчанию хранятся в локальном репозитории на машине разработчика по пути ~/.m2/repository.
- Центральный репозиторий - репозиторий, контролируемый Apache. Для того чтобы залить на него артефакт, необходимо пройти проверку. Удалить артефакт из центрального репозитория невозможно.
- Корпоративный репозиторий - репозиторий с ограниченной областью видимости, доступный только для работников определенной организации. Корпоративные репозитории разворачиваются в виде отдельных серверов. Самыми популярными решениями являются:
    - Nexus от компании Sonatype
    - Artifactory от компании JFrog
    - Archiva от Apache
    - Также сейчас набирают популярность облачные корпоративные репозитории.

Когда Maven собирает проект, сначала он ищет необходимые зависимости в локальном репозитории. Если какие-либо зависимости там отсутствуют, то Maven обращается при его наличии к файлу `settings.xml` (в папке `.m2`), в котором обычно прописываются глобальные настройки Maven и координаты корпоративного репозитория. В конце концов, если это не запрещено `settings.xml`, Maven обращается за ненайденными до этого зависимостями в центральный репозиторий, что требует наличия интернет соединения.

---
## Properties

Для того чтобы все версии подключаемых зависимостей были собраны в одном месте можно прописать их все в одном месте - в тегах `<properties></properties>`.
```xml
<properties>
    <junit-version>4.11<junit-version>
</properties>
Тогда в зависимостях нужно будет использовать ссылки на номера версий.
<dependency>
    <groupId>junit</groupId>
    <artifactId>junit</artifactId>
    <version>${junit-version}</version>
</dependency>
```

---
## К изучению:
- [X] Правила наименования проектов: https://maven.apache.org/guides/mini/guide-naming-conventions.html
- [X] Русскоязычный сайт, посвященный Maven: https://www.apache-maven.ru/index.html
- [X] Простым языком на русском: https://java-course.ru/begin/maven_first/
- [X] Основы Maven (видео) ч.1: https://www.youtube.com/watch?v=-Ry_s9LYkio
- [ ]Основы Maven (видео) ч.2: https://www.youtube.com/watch?v=xdgJmZ0Alzo
- [ ] Многомодульные проекты в Maven: https://easyjava.ru/ecosystem/buildtools/maven/mnogomodulnye-proekty-maven/
- [ ] Гайд по Maven от Oracle: https://blogs.oracle.com/developers/mastering-maven-the-series
- [ ] Цикл статей про Maven от Java чемпиона: https://cguntur.me/2020/05/20/understanding-apache-maven-the-series