---
title: "OpenAPI"
tags:
  - web
draft: false
---

# OpenAPI

OpenAPI - это стандарт описания HTTP API (и ему подобных).

Описание API производится с помощью синтаксиса [JSON](../formats/json.md) или YAML.
Каждая версия спецификации OpenAPI имеет JSON-схему, описывающую ограничения файла с описанием API.

## Минутка истории

В сообществе Web-разработчиков можно услышать, что OpenAPI также называют Swagger'ом.
Так происходит из-за истории появления OpenAPI.
Первоначально существовал инструмент Swagger, разрабатываемый компанией SmartBear. 
Он позволял на основе кода автоматически генерировать интерактивную страничку, позволяющую вызывать эндпойнты приложения.
Для описания API необходимо было расставить в своем коде аннотации.
По коду формировалось описание в специальном формате, на основе которого уже создавалась страница. 
```
Код с аннотациями -> Промежуточный формат -> Интерактивная страница
```
Библиотека с аннотациями и тулинг для формирования интерактивной странички вместе составляли инструментарий Swagger.

Промежуточный формат оказался настолько удобен для описания HTTP API, что сообщество предложило выделить его в отдельный независимый стандарт.
Этот стандарт получил название OpenAPI.

Подводя итог:
- OpenAPI - это формат описания HTTP API
- Swagger - это тулинг вокруг OpenAPI


## `openapi.yaml`

В каждом описании API обязательны два параметра: версия спецификации и краткая информация об API.
```yaml
openapi: 3.0.1
info: 
  title: My Lovely API
  version: '1.0'
paths: {}
```

Эндпойнты описываются в разделе `paths`.

У каждого эндпойнта должен быть задан `operationId`. 
Можно воспринимать его как название метода.
Эндпойнт может отдавать различные коды ответов, каждому из которых будет соответствовать свой формат ответа. 
Описывается это так:
```yaml
# ...
paths:
  /ping: # endpoint URL
    get:
      operationId: ping
      responses:
        '200': # обязательно в кавычках
          description: "ping pong"
          content:
            text/plain: 
              example: "pong"
            application/json:
              schema: 
```

Эндпойнт может принимать/отдавать данные в различных [MIME](mime.md) форматах.
Каждый из них описывается отдельно в разделе `content`.

### Параметры 
В запросе параметры могут находиться в:
- пути URL
- параметрах URL
- в заголовках

```yaml
# ...
paths:
  '/user/{id}':
    get:
      parameters:
        - name: id
          in: path
          # schema
        - name: onlyAlive
          in: query
          # schema
        - name: token
          in: header
          # ...
```

### Тело
Тело запроса описывается с помощью параметра `requestBody`.
```yaml
post:
  requestBody:
    content: 
      application/json:
        schema:
          type: integer
          minimum: 1
          maximum: 100
```

### Схема
Параметр `schema` описывает структуру какого либо параметра или объекта.
У каждой схемы есть тип. 
Допустимые типы:
- объект
- строка
- целое число
- число
- массив
- булево значение
- null

Схема позволяет задать простые ограничения на значения параметров.
Возможные ограничения зависят от типа схемы. 
```yaml
schema:
  type: object
  properties:
    name: 
      type: string
      minLength: 1
      maxLength: 50
    status:
      type: string
      enum: ["NEW", "ACCEPTED", "DECLINED"]
    age:
      type: integer
      minimum: 18
```

Также схема позволяет привести пример значения параметра с помощью тега `example`

### Переиспользование
openapi позволяет переиспользовать отдельные компоненты, вынося их в отдельную группу `components`. 
Выносить в группу можно:
- схемы
- http ответы
- параметры
- и др.

При этом в основном описании вместо того кусочка, который выносится в общую группу, будет оставлена ссылка вида:
```yaml
schema:
  $ref: '#components/schemas/MyLovelyDto'
```

Ссылки подчиняются спецификации JSON References.


---
## Разбивка `openapi.yaml`

Выносить общие части API можно не только в группу `components`, но и в отдельные файлики.
Ссылка на файл при этом приводится с помощью относительного пути.
Для такой файловой структуры
```
|--schemas
|  |--UserCreationDto.yaml
|--paths
|  |--createUser.yaml
|--openapi.yaml
```

Ссылка на эндпойнт `createUser` из основного файла `openapi.yaml` будет задана
```yaml
/user:
  $ref: './paths/createUser.yaml'
```

В файле `createUser.yaml` ссылка на DTO `UserCreationDto` будет представлена так:
```yaml
schema:
  $ref: '../schemas/UserCreationDto.yaml'
```


Для сборки `openapi.yaml` из фрагментов можно использовать:
- swagger-cli - консольная утилита, написанная на JavaScript. Давно не обновлялась, возможно заброшена.
- openapi-cli - консольная утилита, написанная на JavaScript. Развивает идеи swagger-cli. Пока не вышла из беты.


## К изучению
- [ ] [Обзор OpenAPI](https://oai.github.io/Documentation/start-here.html)
- [ ] [Официальная документация]()
- [X] [Список инструментов](https://openapi.tools/) вокруг OpenAPI
- [X] [Разница между OpenAPI и Swagger](https://swagger.io/blog/api-strategy/difference-between-swagger-and-openapi/)