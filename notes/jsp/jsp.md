---
title: "JSP"
tags:
  - java_ee
  - jsp
  - web  
  - deprecated
draft: false
---

**JSP** - java server pages

JSP - внебрачный сын Java и HTML, позволяющий встраивать Java-код в HTML разметку.

В современных проектах JSP не используется, вместо этого код разбит на бэкэнд и фронтенд, которые общаются между собой с помощью REST или SOAP. Но в legacy проектах еще можно встретить JSP.

При компиляции JSP превращается в обычный [сервлет](../servlets/servlet.md).

---
## Синтаксис

JSP позволяют вставлять в HTML разметку Java-код. Делается это с помощью специальных тегов:

- `<% [Ничего не возвращающий Java-код] %>` - выполняет код. Такой фрагмент называется **скриплетом**.
- `<%= [Java-код, возвращающий строку] %>` - выполняет код и вставляет результат в разметку
- `<%! [Java-код, описывающий элементы сервлета, вне методов doGet и doPost] %>` - этот элемент называется **декларацией**.
- `<%-- Комментарий --%>` - можно закомментировать ранее написанный код. Такие комментарии, в отличие от html-комментариев не будут отправляться клиенту.

В стандартном теге можно писать много кода, разделяя выражения с помощью `;`. Тег со знаком равно позволяет написать только один оператор и не требует простановки точки с запятой.

Стандартный тег также позволяет записывать текст в HTML разметку c помощью *переменной out*.

```jsp
<% out.println("Vovan - loh"); %>
```

Если java-метод возвращает строку, то можно не писать out.println, а написать так:

```jsp
<%= LohHelper.whoIsWho("Vovan") %>
```

По сути синтаксис `<%= ... %>` аналогичен `<% out.println(...); %>`, но пишется короче.

Важно: Java-код, записанный внутри HTML комментариев, будет исполняться!

Также есть разметка, которая называется *Action*. Она бывает двух видов:

- `standard` - стандартное действие
- `custom` - произвольное действие

Выглядит Action, как одиночный тег html:
```jsp
<jsp:include page="vovanLoh.jsp" /> <!-- для стандартных действий -->
<c:set variable="Vovan" value="Loh" /> <!-- для кастомных действий -->
```

Подробнее об Action тут: [JSP Actions](jsp_actions.md)

---
## Обращение к JSP

JSP сам по себе компилируется в сервлет и к нему может быть получен доступ с помощью перехода по URL, которая ведет к .jsp-файлу.

Но можно задать к нему доступ с помощью web.xml, также как для сервлетов:
```xml
<servlet>
    <servlet-name>JspServlet</servlet-name>
    <jsp-file>jspServlet.jsp</jsp-file>
</servlet>
<servlet-mapping>
    <servlet-name>JspServlet</servlet-name>
    <url-pattern>/jsp-servlet</url-pattern>
</servlet-mapping>
```

---
## Директивы

Существует три типа директив:

- `page` - определяет кодировку, MIME-тип возвращаемого значения
- `taglib` - указывает библиотеки тегов, который может использовать JSP.
- `include` - подключает какой-либо стандартный html-код, чтобы его не нужно было дублировать в различных JSP.

### Директивы Page

Директивы Page обычно прописывают в самом начале JSP.
У директивы page есть следующие атрибуты:

- `import` - позволяет импортировать java-библиотеки

```jsp
<%@ page import="java.util.Date, javax.servlet.http.*" %>
```

импортируемые классы записываются как значения параметра import в кавычках через запятую.

- `contentType` - устанавливает тип возвращаемого контента в MIME. По умолчанию text/html.
- `isThreadSafe` - указывает является ли сервлет потокобезопасным. По умолчанию true. Если выставить false, то сервлет унаследуется от SingleThreadModel, а это bad practice.
- `isELIgnored` - указывает следует ли игнорировать [expression language](expression_language.md) синтаксис. По умолчанию не установлен (если в дескрипторе развертывания будет запрещен EL, то в данном JSP он будет игнорироваться).
- `isErrorPage` - указывает является ли данная страница страницей ошибки. По умолчанию false. Если true, то страница получает доступ к объекту исключения.
- `errorPage` - указывает URL, на который будет перенаправляться клиент при возникновении ошибки на текущей страничке.
- `session` - включает или выключает автоматический трекинг сессии. Принимает значения true или false. По умолчанию имеет значение true.

### Директивы Taglib

```jsp
<%@ taglib tagdir="/WEB-INF/tags/cool" prefix="cool" %>
```

### Директивы Include

Атрибуты:

- `file` - указывается ссылка на .jsp или .html файл, который будет включен в ту часть страницы, куда вставлена данная директива.

```jsp
<%@ include file="standardHeader.html" %>
```

Подключенные с помощью директивы файлики невозможно будет изменить без редеплоймента (повторного развертывания) веб-приложения.

---
## Переменные JSP-сервлета

JSP предоставляют доступ к некоторым предопределенным переменным:

| **Имя переменной** | **Класс** | **Предназначение** |
| --- | --- | --- |
| `out` | `JspWriter` (буферизированный `PrintWriter`) | для вывода информации в обычных тегах <% ... %> |
| `config` | `ServletConfig` | Доступ к параметрам сервлета |
| `application` | `ServletContext` | Доступ к параметрам и атрибутам веб-приложения |
| `session` | `HttpSession` | Доступ к атрибутам и свойствам сессии |
| `request` | `HttpServletRequest` | Доступ к куки, атрибутам и параметрам запроса |
| `response` | `HttpServletResponse` | Для установки возвращаемого типа |
| `pageContext` | `PageContext` | Для хранения атрибутов страницы |

---
## Интерфейс JspPage

Когда JSP преобразуется в сервлет, он становится объектом класса JspPage. В этом интерфейсы есть методы, которые ответственны за различные этапы жизни сервлета.

Методы:

- `void jspInit()` - метод вызывается при инициализации сервлета
- `void jspDestroy()` - метод вызывается при смерти сервлета

---
## Контекст страницы

По аналогии с контекстом веб-приложения, существует контекст страницы, в которой определены свои [атрибуты](../servlets/webapp_attributes.md).

Контекст страницы представлен объектом `pageContext` класса `PageContext`.

Контекст страницы круче всех остальных, потому что он предоставляет доступ ко всем типам атрибутов: атрибутам приложения, сессии, запроса и страницы.

Константы, описывающие сферы атрибутов:

- `static final int APPLICATION_SCOPE`
- `static final int PAGE_SCOPE`
- `static final int REQUEST_SCOPE`
- `static final int SESSION_SCOPE`

Методы:

- Работа с [атрибутами](../servlets/webapp_attributes.md):
    - `void setAttribute(String, Object)` - устанавливает атрибут страницы
    - `void setAttribute(String, Object, int scope)` - устанавливает атрибут в выбранной сфере
    - `Object getAttribute(String)` - возвращает атрибут страницы
    - `Object getAttribute(String, int scope)` - возвращает атрибут указанной сферы
    - `Enumeration getAttributeNamesInScope(int scope)` - возвращает перечисление атрибутов указанной сферы.
    - `Object findAttribute(String)` - ищет атрибут с таким именем во всех сферах и возвращает его. Ищет по-очереди в атрибутах страницы, запроса, сессии и, наконец, веб-приложения.
- получение других объектов:
    - `HttpServletRequest getRequest()` -
    - `ServletConfig getServletConfig()` -
    - `ServletContext getServletContext()` -
    - `HttpSession getSession()` -

---
## Отключение скриплетов

Считается, что наличие Java-кода в JSP - это плохо, потому что JSP должны разрабатывать фронтэндеры или верстальщики, которым ни к чему знать Java. Для них был придуман [Expression Language](expression_language.md).

А для того чтобы запретить бэкендерам лезть в JSP решили дать возможность отключения скриплетов в JSP с помощью дескриптора развертывания web.xml:

```xml
<jsp-config>
    <jsp-property-group>
        <url-pattern>*.jsp</url-pattern>
        <scripting-invalid>true</scripting-invalid>
    </jsp-property-group>
</jsp-config>
```

---
## К изучению

- [X] Урок от Алишева: https://www.youtube.com/watch?v=LurhKar9suY&list=PLAma_mKffTOTTFqIkLXgHqVuL6xJhb0mr&index=4
- [X] Глава 7 Head First Servlets and JSP