---
title: "Configuration"
tags:
  - devops
  - architecture
draft: false
---

# Configuration

При [развертывании](./deployment.md) приложений, как правило, необходимо передать им настройки, характерные для среды развертывания.
Например, при деплое на тестовые контуры приложению нужно передать настройки подключения к тестовой базе данных, а при деплое на прод среду - настройки подключения к продовой БД.

Существуют различные подходы к передаче настроек в приложение:
- с помощью конфигурационных файлов
- с помощью [env переменных](../linux/env_variables.md)
- с помощью центрального хранилища


---
## Конфигурационные файлы

В этом случае перед запуском приложению подкладывается конфигурационный файл с нужными настройками.
Приложение при запуске первым делом вычитывает этот файл и использует настройки при исполнении.

Так приложение может поставляться сразу с несколькими конфигурационными файлами для разных сред.
При запуске приложения необходимо указать какой из файлов конфигураций необходимо использовать.

Такой подход иногда используется в Spring Boot приложениях.
Создаются файлы с суффиксами, означающими профиль конфигурации: `application-test.yml`, `application-tx.yml`.
Здесь профилями являются суффиксы `test` и `tx`.
Приложение может быть запущено сразу с несколькими профилями (т.к. разные профили могут конфигурировать разные части приложения).


---
## Env переменные

_Env переменные_ - это параметры процесса, запущенного в операционной системе.

Такой способ конфигурации принят в коробочных продуктах, распространяемых в [docker](./docker.md)-образах.
Значения env переменных можно передать при старте контейнера или прописать в [docker-compose](./docker_compose.md) файле.

В некоторых экосистемах (например, Python) принято хранить env переменные рядом с приложением в файле.
В этом случае их использование становится в чем-то похожим на конфигурацию с помощью конфигурационных файлов.


---
## Центральное хранилище

В этом варианте переменные распространяются с помощью отдельного приложения - конфигурационного сервера.
Приложение при старте обращается к конфигурационному серверу и выкачивает из него настройки.

Сами настройки при этом могут храниться, как в какой-либо базе данных, так и в git.
Подход с git в последнее время более популярен, потому что позволяет отслеживать изменения в конфигурации.

Примеры коробочных конфигурационных серверов:
- Spring Cloud Config - часто используется в экосистеме Spring
- Hashicorp Vault - хотя основная задача продукта - это хранить секреты, но ничего не мешает распространять с его помощью и другие настройки


---
## К изучению
- [X] [Externalized configuration](https://microservices.io/patterns/externalized-configuration.html)
