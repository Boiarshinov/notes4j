---
title: "Jenkins"
tags:
  - devops
draft: false
---

# Jenkins

**Jenkins** - 

Типичные шаги CI процесса:
- Запуск пайплайна при поступлении нового кода в репозиторий от разработчиков
- Сборка кода
- Тестирование
- Выпуск артефактов
- Деплой

Jenkins построен на плагинах.
Например, сборка кода на Java может вестись с помощью Maven или Gradle плагина.

Агент - todo
Пайплайн - todo

## Архитектура Jenkins
Jenkins представляет собой кластер из отдельных приложений, связанных по принципу master - slave.
Главной нодой является **Jenkins Server**, он выкачивает обновленный код из репозиториев и ставит задачу по прогону пайплайна одному из агентов.

Jenkins Server - представляет собой Java веб-приложение, написанное с использованием веб-сервера Jetty.


## Jenkinsfile
**Jenkinsfile** - это текстовый файл, в котором содержится описание пайплайна конкретного проекта.
Как правило, этот проект хранится в репозитории конкретного проекта.

## Pipeline
**Pipeline** - это последовательность шагов, выполнение которых ведет к какой-либо единой цели.

**Node** - это конкретная машинка, на которой может быть запущен пайплайн

Пайплайн разделяется на этапы, называемые **Stage**. 
Стейджы выполняются последовательно один за одним. 
Если какой-либо стейдж прервал выполнение с ошибкой, то остальные стейджы не выполняются, а пайплайн завершается как неуспешный.
В Jenkins UI стейджи изображаются в виде колонок таблицы, которая изображает прохождение последних билдов.

Каждая операция в стейдже называется шагом - **Step**.

Для описания пайплайнов существует два различных синтаксиса:
- декларативный - специфичный синтаксис, который легко изучить. Подходит для описания несложных пайплайнов
- скриптовый - Groovy, с помощью которого можно описать что угодно, но придется выучить новый язык

### Декларативный
```jenkinsfile
pipeline {
    agent any 
    stages {
        stage('Build') { 
            steps {
                // 
            }
        }
        stage('Test') { 
            steps {
                // 
            }
        }
        stage('Deploy') { 
            steps {
                // 
            }
        }
    }
}
```

### Скриптовый
Скриптовый синтаксис позволяет описывать шаги с помощью языка Groovy.
Благодаря этому можно использовать управляющие конструкции и другие фишки языка.
```jenkinsfile
node {  
    stage('Build') { 
        // 
    }
    stage('Test') { 
        // 
    }
    stage('Deploy') { 
        // 
    }
}
```

## Jenkins-Job-Builder
Желаемая конфигурация пайплайнов может несколько отличаться для разных сред разработки.
Избежать дублирования при описании пайплайнов помогает python библиотека **Jenkins-Job-Builder**.
Она позволяет декларативно описать различные конфигурации стендов и пробросить необходимые параметры в дженкинсфайл.
При вызове CLI Jenkins-Job-Builder собирает скрипт, валидирует его на корректность и отправляет на Jenkins Server. 

---
## К изучению

- [ ] [Официальная документация](https://www.jenkins.io/doc/)
- [ ] [Обзорное видео](https://www.youtube.com/watch?v=LFDrDnKPOTg&ab_channel=Simplilearn)
- [X] [Синтаксис описания пайплайнов](https://www.jenkins.io/doc/book/pipeline/syntax)
- [] [Документация](https://jenkins-job-builder.readthedocs.io/en/latest/) на Jenkins-Job-Builder