---
title: "Monitoring"
tags: 
  - monitoring
draft: false
---

# Monitoring

Любая информационная система состоит из двух частей: hardware и software. 
Мониторить нужно обе части, но по-разному.

Hardware мониторят по правилу USE:
- __Utilization__ - процент использования
- __Saturation__ - количество задач в очереди на обработку
- __Errors__ - количество ошибок

Software мониторят по правилу RED:
- __Rate__ - количество запросов в единицу времени
- __Errors__ - количество ошибок
- __Duration__ - длительность обработки запроса

__throughput__ - текущая нагрузка на сервер
__bandwith__ - максимальное количество tcp-пакетов, которое может принять сервер. Зависит в основном от конфигурации Сети.


После того, как мониторинг выявит проблему ее необходимо локализовать.
Для этого используется либо __профайлинг__ - сбор дополнительных метрик, либо __трейсинг__ отслеживание пути запроса.


## Архитектура
Метрики собираются -> хранятся -> обрабатываются -> визуализируются и алертятся

Источники метрик:
- сервер:
  - CollectD
  - Telegraf
  - Carbon
  - top, vmstat, ...
- приложение:
  - JMX
  - Dropwizard - уже редко используется, все перешли на Micrometer
  - [Micrometer](../external_lib/micrometer.md)
  - spring-metrics
- коробочные системы - у каждой системы есть свой API для получения метрик
  - БД
  - брокеры сообщений
  - балансировщики
  - etc.

## Метрики
Виды метрик и возможные сценарии использования
- счетчик - __counter__
  - количество запросов к серверу
  - количество загруженных файлов
- датчик - __gauge__
  - объем используемой оперативной памяти
  - количество открытых сессий
- гистрограмма - __histogram__
  - количество запросов к серверу за каждый час
- статистика - __summary__
  - среднее и максимальное время ответа за последний час

## Трейсинг
- откуда пришел запрос
- с какими аргументами
- сколько длился каждый этап



---
## К изучению
- [ ] [USE method](https://brendangregg.com/usemethod.html)
- [ ] How to solve Java Performance Problems. [Part 1](https://mydeveloperplanet.com/2018/11/14/how-to-solve-your-java-performance-problems-part-1/), [part 2](https://mydeveloperplanet.com/2018/11/28/how-to-solve-your-java-performance-problems-part-2/)
- [ ] [Гайд по поиску проблем от Alibaba](https://alibaba-cloud.medium.com/a-handy-guide-to-optimizing-your-java-applications-7e254110f583)
- [X] [Курс по многопоточности в Java](https://fillthegaps.getcourse.ru/mt7)