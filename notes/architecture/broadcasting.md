---
title: "Броадкастинг"
tags: 
  - distributed_system
  - network
draft: false
---

# Броадкастинг

Броадкастинг - концепция в распределенных системах, при которой нода, породившая событие, уведомляет о нем все остальные ноды. 
При этом количество нод может изменяться со временем.

Существуют системы, в которых броадкастинг происходит на уровне железа.
Обычно это небольшие (локальные) сети.
В этой заметке рассматриваются более глобальные сети, и предполагается, что ноды между собой могут общаться только точка-точка.

В броадкастинге обычно существует промежуточный программный слой между системой и сетью.
Этот промежуточный слой занимается реализацией одного из алгоритмов броадкастинга.

## Виды броадкастинга
- Best-effort - нода, породившая событие, пытается оповестить об этом остальные ноды, но доставка сообщения не гарантирована
- Reliable - все события доходят до всех нод
- FIFO - если события А и Б были порождены одной нодой, причем А раньше Б, то все ноды броадкастят А раньше Б. События, произошедшие на разных нодах, могут быть приняты в каком угодно порядке.
- Причинный (Causal) броадкастинг - если событие Б, принадлежащее одной ноде, создано на основе события А, принадлежащего другой ноде, то оповещение об этих событиях других нод должно происходить в порядке А раньше Б. 
- Атомарный (total order) броадкастинг - все события на всех нодах должны быть приняты в одинаковом порядке. Даже если нода принимает событие, которое она же сама и породила.
- FIFO - total order броадкастинг - совокупность FIFO и атомарного броадкастинга.

Строгость видов броадкастинга:
```
Best-effort < Reliable < FIFO < Causal < 
                                         FIFO - Total order
                       < Total order   <
```

### Приведение Best-effort к Reliable
Для того чтобы сделать best-effort броадкастинг надежным (reliable) можно попробовать добавить ретраи на отправку сообщений.
Но это не поможет.
Если нода упадет после неудачной попытки ретрая, то сообщение так и не будет доставлено.
Можно вместо этого заставить все ноды, получившее сообщение, перепосылать его остальным нодам.
К сожалению, это ведет к огромной нагрузке на сеть.
Для распределенных систем с большим количеством нод можно использовать Gossip Protocol.

### Приведение Reliable к более строгим видам
Для приведения reliable броадкастинга к FIFO и Causal используются [векторные часы](../algorithms/vector_clock.md).

Для приведения Reliable броадкастинга к Total Order необходимо:
- либо иметь главную ноду (лидера), через которую осуществляется весь броадкастинг
- либо использовать [часы Лэмпорта](../algorithms/lamport_clock.md)

Оба подхода не являются fault tolerant.


---
## К изучению
- [X] [4 лекция](https://www.youtube.com/watch?v=A8oamrHf_cQ&list=PLeKd45zvjcDFUEv_ohr_HdUFe97RItdiB&index=16&ab_channel=MartinKleppmann) курса по распределенным системам от Мартина Клеппманна
- [ ] [Wiki. Gossip Protocol](https://en.wikipedia.org/wiki/Gossip_protocol)