---
title: "Ограничитель трафика"
tags: 
  - architecture
draft: true
---

# Rate Limiter

**Rate Limiter** - ограничитель трафика - подсистема, предназначенная для отсечения избыточной нагрузки на сервис.
Как правило rate limiter реализуется на серверной стороне, хотя в некоторых случаях его пишут и на клиентской части.

Rate Limiter может быть использован в бизнес-модели монетизации сервиса.
Например, многие провайдеры API позволяют пользоваться своим сервисом бесплатно при небольшом трафике, а чтобы снять ограничение, требуется заплатить.
При этом лимиты трафика могут быть разделены по ценовым диапазонам.

Пример ограничения: один пользователь может отправить не более 300 твитов в час.

Rate limiter чаще всего включается в API Gateway, но иногда может быть реализован и отдельным сервисом.
todo схема



## Превышение лимита
При превышении лимита необходимо сообщить клиенту, что количество возможных запросов от него исчерпано, и сказать когда он сможет послать очередной запрос.
При взаимодействии клиента и сервера по HTTP сервер возвращает код статуса 429 - Too Many Requests.
Дополнительная информация передается в заголовках ответа:
- `X-???` - todo


## Виды rate limiter'ов
Существует множество различных реализаций алгоритма rate limiter'а:
- **token bucket** - 
- **leaking bucket** - 
- **fixed window counter** - 
- **sliding window log** -
- **sliding window counter** - 

### Token Bucket
todo


### Leaking Bucket
todo


### Fixed Window Counter
Rate Limiter на основе фиксированного окна разбивает шкалу времени на равные промежутки.
В течение каждого промежутка ведется подсчет входящих запросов.
При превышении счетчиком порогового значения, запросы отклоняются.
При переходе на новый временной промежуток счетчик сбрасывается.

Недостатком фиксированного окна является то, что если запросы будут сгруппированы у окончания одного окна и начала следующего окна, то система может получить в 2 раза больше трафика (но не более), чем было заявлено в ограничениях.

![fixed window rate limiter](../../images/src/fixed_window_rate_limiter.drawio.svg)


### Sliding Window Log
todo


### Sliding Window Counter
todo


---
## К изучению

- [X] Книга Алекса Сюй "System Design Interview", глава 4
- [X] Подкаст javaswag. Выпуск 26 с Максимом Бартковым