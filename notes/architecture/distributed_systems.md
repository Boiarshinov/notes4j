---
title: "Распределенные системы"
tags: 
  - distributed_system
draft: false
---

# Распределенные системы

Распределенные системы - это системы, взаимодействующие части которых находятся на разных вычислительных устройствах.

Распределенные системы создаются, когда:
- система по своей природе должна быть распределенной. Например, мессенджер
- для увеличения надежности
- для ускорения (положить данные ближе к пользователям)
- для выполнения сложных задач, с которыми не может справиться одна машина

Распределенные системы подвержены следующим проблемам:
- пропадание связи между частями системы
- выход из строя частей системы (падение ноды)

При общении частей распределенной системы, возникают задержки, обусловленные временными затратами на передачу данных.
Эти задержки называются **latency**.
При оценке быстродействия распределенных систем можно ориентироваться на следующие цифры:
- ~ 1 мс - части системы находятся в одном датацентре
- ~ 100 мс - части системы находятся на разных континентах


## RPC

Обращение к удаленной части системы зачастую хотят представить как обращение к внутренней.
Такое обращение называется [RPC](inter_process_communication.md) - Remote Procedure Call.
Для того чтобы упростить RPC вызов в коде, используются различные RPC-фреймворки.


## Проблемы распределенных систем

### Проблема двух генералов

Проблема, свойственная всем распределенным системам формулируется так:

Город осаждается двумя армиями.
Одна армия находится с одной стороны от города, другая армия - с другой.
Город возможно захватить только если напасть одновременно.
Если напасть порознь, то город сможет отбиться, и второй армии уже не удастся его захватить.
Руководят армиями генералы, и они пытаются договориться о времени атаки, отправляя друг другу гонцов.
Гонцов могут перехватить по дороге.

В таких условиях рождается проблема: 
Пусть первый генерал отправляет гонца с указанием времени атаки.
Гонец прибегает ко второму генералу, сообщает ему время, и бежит обратно, чтобы донести, что послание доставлено.
Если гонца перехватят, то первый генерал не будет знать на каком этапе его перехватили: до встречи со вторым генералом или после.
Поэтому первый генерал решает, что он пойдет в атаку только если гонец вернется.

Но теперь второй генерал попадает в ту же ситуацию.
Он знает, что первый генерал пойдет в атаку, если гонец вернется, но не знает ничего о судьбе гонца.
Таким образом они никогда не смогут договориться.

Можно переложить эту проблему на IT следующим образом: 
Пусть есть интернет магазин, который для оплаты заказа обращается к стороннему платежному шлюзу.
Магазин хочет отправлять заказ только если произошла оплата.
Платежный шлюз не хочет списывать деньги, если не уверен, что магазин отправит заказ.

В данном случае проблема решается просто - платежный шлюз должен списывать деньги всегда.
Магазин же, если не дождался ответа от шлюза при первом запросе, должен дополнительным запросом узнать статус оплаты.
И только после этого начать собирать заказ.


### Проблема византийских генералов

Проблема византийских генералов, является развитием проблемы двух генералов.
Пусть теперь генералов не 2, а от 3 и более.
Они все так же пытаются договориться о времени встречи.
Гонцов теперь перехватить невозможно.
Но среди генералов есть предатели - они могут врать другим генералам.
Причем предатели еще и знают друг о друге и могут устраивать сговоры.

Все это очень похоже на игру "Мафия" или на Among Us.

Существует доказательство, что для того чтобы генералам вычислить предателей и все-таки договориться о времени атаки, нужно, чтобы общее количество генералов
превышало количество предателей согласно следующей формуле.
```
allGeneralsCount > 3 * traitorsCount + 1
```

Если генералы могут использовать криптографию, то общее необходимое количество сокращается, но общение между ними становится очень сложным.


### Проецируя на информационные системы

Перекладывая на информационные системы:
- проблема двух генералов - про проблемы в сетевом взаимодействии
- проблема византийских генералов - про проблемы в общении между сервисами или нодами одного приложения

В реальном мире в распределенных системах возникают оба вида проблем.


## К изучению

- [ ] [Видео-курс от Мартина Клеппмана](https://www.youtube.com/watch?v=UEAMfLPZZhE&list=PLeKd45zvjcDFUEv_ohr_HdUFe97RItdiB&ab_channel=MartinKleppmann)