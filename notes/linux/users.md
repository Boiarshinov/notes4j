---
title: "Linux users"
tags:
  - linux
draft: true
---

# Users

Пользователи - это одна из основных абстракций OS Linux. 
Любой файл принадлежит какому-либо пользователю.
Любая команда выполняется от имени какого-либо пользователя.

Группы - это множества пользователей.
Разрешение на работу с каким-либо файлом может быть выдано группе, и тогда все входящие в нее пользователи получат доступ к этому файлу.

У каждого пользователя есть одна первичная группа и множество вторичных групп, в которые он может входить.

## Пользователи

Основной пользователь - `root`, еще он называется __суперпользователем__. 
Он создается по умолчанию в любом дистрибутиве Linux.
Этот пользователь может делать в системе все что угодно, поэтому из соображений безопасности на серверах и в контейнерах обычно создают отдельных пользователей, которым выдают минимально необходимые права.

Большинство серверных приложений, как правило запускаются из под выделенной служебной учетной записью.
Например, база данных PostgreSQL запускается из под учетной записи postgres.
Делается это для того, чтобы не дать приложению сломать систему.
Как в случае ошибки в программном коде, так и в случае злоумышленника, который получил доступ к этому приложению.

Данные о всех пользователях находятся в файле `/etc/passwd` в следующем формате:
```
username:*:uid:main_gid:user description:home_dir:start_shell
```

Например, информация о служебном пользователе __mysql__ может быть представлена в виде:
```
mysql:*:74:74:MySQL Server:/var/empty:/bin/false
```

Пароли пользователей хранятся в хэшированном виде в отдельном файле `/etc/shadow`.

Пользователя определяет его имя и идентификатор `uid`.
Группу определяет идентификатор `gid`.
Как правило у каждого пользователя есть основная группа, в которой состоит только он сам.


### Команды для работы с пользователями

`whoami` - какой пользователь сейчас активен
```sh
❯ whoami
boiarshinov
```

`id` - выдает информацию о текущем пользователе и его идентификаторе, его группах и их идентификаторах
```sh
❯ id
uid=501(boiarshinov) gid=20(staff) groups=20(staff),12(everyone),61(localaccounts),79(_appserverusr),80(admin)
```

`su` - меняет текущего пользователя
```sh
❯ su - arty
```
Чтобы выйти из пользователя, используется команда `exit`
```sh
❯ su - arty
❯ whoami
arty
❯ exit
❯ whoami
root
```


### Добавление и удаление

Добавить пользователя можно с помощью одной из двух команд:
- `adduser` - интерактивная утилита
- `useradd` - неинтерактивная утилита

`useradd` обычно используется в скриптах, а `adduser` при ручном добавлении.
С использованием дополнительных ключей команду `adduser` можно тоже превратить в неинтерактивную.
Это бывает полезным из-за того, что в некоторых сборках Linux присутствует только эта команда.

Удалить пользователя можно с помощью команд:
- `userdel`
- `deluser`


---
## Группы

Группа - это абстракция, позволяющая выразить множество пользователей.
Группы нужны для того, чтобы проще было управлять доступом к различных файлам и директориям сразу для нескольких пользователей.
Группа может существовать сама по себе, не имея ни одного пользователя.

Информация о всех группах находится в файле `/etc/group` в следующем виде:
```
group_name:*:gid:user1,user2
```

Например, может существовать группа `admin`
```
admin:x:80:root
```

Если у группы не указаны пользователи в этом файле, это не значит, что в группу никто не входит.
В группу по умолчанию входят те пользователи, у которых в файле `/etc/passwd` в качестве основного пользователя указан gid этой группы.


### Команды для работы с группами

`addgroup [-g <gid>] <groupname>` - создать группу с указанным идентификатором

`groups` - посмотреть список всех групп.
```sh
❯ groups
staff everyone localaccounts _appserverusr admin _appserveradm _lpadmin com.apple.sharepoint.group.1 _appstore _lpoperator _developer _analyticsusers com.apple.access_ftp com.apple.access_screensharing com.apple.access_ssh com.apple.access_remote_ae
```

`adduser [-G <groupname>] [-u <uid>] <username>` - создать пользователя в указанной группе с указанным идентификатором


## Sudo

`sudo` - позволяет выполнять команды от имени суперпользователя, не переключаясь на него. Утилита sudo установлена не во всех дистрибутивах Linux, и зачастую отсутствует в docker-контейнерах.
`sudo` работает только для тех пользователей, которые входят в группу `sudo`.

Перечень возможностей, которые можно выполнить с помощью `sudo` может быть ограничен.
Посмотреть свои возможности можно с помощью команды
```bash
❯ sudo -l
User boiarshinov may run the following commands on Artems-MacBook-Air:
  (ALL) ALL
```


---
## К изучению
- [X] [Основные команды](https://sysadminium.ru/groups_and_users_in_linux/)
- [ ] [Основные понятия и команды](https://chukin.ru/edu/linux/03.php)
