---
title: "Linux file permissions"
tags:
  - linux
  - security
draft: false
---

# Разрешения на доступ к файлам в Linux

У каждого файла в Linux есть ограничения доступа.
Посмотреть их можно например с помощью команды `ls -l`:
```bash
❯ ls -l filename
-rw-r--r--.   1    arty   staff    452    May 17 19:32    filename
```

Первый фрагмент вывода как раз показывает разрешения на доступ к файлу.
Первый символ этого фрагмента отвечает за [тип файла](./file_types.md): обычный файл, директория, сокет или что-то еще.
Директории в Linux также являются файлами (всё - файл!), поэтому для них настройки доступа так же справедливы. 
Что означают остальные странные символы, смотри ниже.

У каждого файла есть свой [пользователь владелец и группа владелец](./users.md).
Владельцы также указывается в выводе команды.
В примере выше `arty` - это пользователь, владеющий файлом, а `staff` - группа, владеющая файлом.

Девять символов из первого фрагмента и есть разрешения.
Их можно разделить на три группы, где первая будет отражать разрешения пользователя, вторая - группы, третья - любых других пользователей, не входящих в группу.
```
user
|   group
|   |   others
|__ |__ |__ 
rwx rwx rwx
```

Символы означают следующее:
- `r` доступно чтение файла
- `w` доступна запись в файл
- `x` доступно исполнение файла
- `-` доступа на операцию нет

Для примера `rwxrw-r--` означает, что пользователь владелец может читать, редактировать и запускать файл; пользователи группы могут читать и редактировать файл, но не запускать его; а все остальные пользователи могут только читать файл.

Для директорий те же символы означают следующее:
- `r` доступен просмотр списка файлов в директории
- `w` доступно создание и удаление файлов в директории
- `x` доступно изменение мета-информации о директории. Обычно всегда установлен для директорий
- `-` доступа на операцию нет

### Octet view
Доступы к файлу могут быть представлены не только в виде девяти букв, но и в виде трех цифр.
Такое представление называют октетами, т.к. доступ каждой тройки букв выражается с помощью одной цифры в восьмеричной системе счисления.
Каждая буква представляется как бит в трехзначном бинарном представлении.
Если буква есть - значит бит выставлен, если вместо буквы прочерк - значит бит не выставлен.
Переводя в восьмеричную систему получится, что каждой букве соответствует цифра:
- `r` - 4 - `100`
- `w` - 2 - `010`
- `x` - 1 - `001`
- `-` - 0 - `000`

Таким образом, сочетание `rwx` может быть представлено числом `7`.
Каждая тройка букв представляется своей цифрой.
Доступ `rwxrw-r--` преобразуется в `764`.

В октетном представлении удобно назначать доступ к файлу с помощью команды `chmod`.


---
## Установка доступов

Основные команды для изменения настроек доступа:
- `chown` - изменить пользователя владельца
- `chgrp` - изменить группу владельца
- `chmod` - поменять настройки доступа

`chown` можно использовать только из под рутового пользователя.
```bash
sudo chown another_user path/to/file
```

`chmod` позволяет указывать права как в октетном виде, так и в символьном.
В октетном удобнее установить права сразу на все 3 группы доступов.
А в символьном удобнее модифицировать доступы для определенной части доступов.
Например, чтобы выставить права сразу на все 3 группы необходимо вызвать:
```bash
chmod 764 path/to/file
```
Выдавать файлам права `777` крайне не рекомендуется, хотя в моменты отчаяния и очень хочется. 

А для того, чтобы например добавить права на запись для группы, не изменяя остальные настройки доступа, нужно вызвать:
```bash
chmod g+w /path/to/file
```
Здесь символ `g` означает группу, символ `u` - пользователя, а символ `o` - остальных.
Символы `+` и `-` добавляют или убирают права соответственно.
А с помощью символа `=` можно полностью переопределить права.
```bash
chmod u=rwx,g+w,o-w /path/to/file
```


---
### Sticky bit
Параметр `w` для директории позволяет кому-угодно удалять файлы в этой директории.
Но такое поведение зачастую является нежелательным.
Например, многие процессы пользуются директорией `/tmp` для хранения своих временных файлов, и было бы нежелательно, чтобы другие процессы имели возможность удалить эти временные файлы (файлы могут еще использоваться в момент удаления, что приведет к некорректной работе процесса).
Поэтому для директорий есть еще один флажок, обозначающий, что удалять файлы может только их создатель.
Это флажок обозначается как `t` в конце обозначения доступов:
```
❯ ls -la /private/tmp
drwxrwxrwt  29 root         wheel  928 May 17 23:38 .
```

### SUID и SGID
Символ `x` для исполняемых файлов означает, что файл можно выполнить.
При этом запустится процесс, и этот процесс будет выполняться от имени пользователя, вызвавшего команду.
Но некоторые процессы требуют, чтобы они запускались всегда под определенным пользователем.
В этом случае для таких файлов может быть установлен специальный флаг `s` вместо `x`, и такие файлы будут всегда запускаться от имени пользователя владельца.
Флаг `s` также называется `SUID`

Например, утилита crontab всегда запускается под рутом:
```bash
❯ ls -la /usr/bin/crontab
-rwsr-xr-x  1 root  wheel  203984 Nov 18 21:13 /usr/bin/crontab
```

Такой же флаг существует и для группового доступа, он называется `SGID`.
Его чаще всего используют для директорий, чтобы файлы, создаваемые в директории, получали сразу групповой доступ директории, а не пользователя, создавшего файл.


---
## К изучению
- [X] Статья от RedHat о [разрешениях](https://www.redhat.com/sysadmin/linux-file-permissions-explained)
- [ ] [Статья о разрешениях](https://www.guru99.com/file-permissions.html) на Guru99