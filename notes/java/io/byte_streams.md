---
title: "Потоки байт"
tags:
  - io
draft: false
---

Для работы с потоками байт существуют два основных класса: `InputStream` и `OutputStream`

## InputStream
Класс является абстрактным, хотя по сути он принадлежит к интерфейсам.
Популярная реализация:
- `static System.in` - поток ввода. Его можно подменить воспользовавшись методом `System.setIn(InputStream)`.
```java
InputStream inputStream = new ByteArrayInputStream({1, 20, 80, 255, 30});
System.setIn(inputStream); //Теперь поток будет читать байты из введенного массива байт.
```

Методы:
- `int available()` - возвращает число байт доступных для чтения. Данный метод не следует использовать для подсчета количества оставшихся для передачи байт при передаче файлов по сети, так как узнать сколько осталось получить в таком случае невозможно. Вызов метода в таком случае может привести к ошибке.
- `void close()` - закрывает источник ввода
- `int read()` - возвращает целочисленное представление следующего байта в потоке.
- `int read(byte[])` - читает байты в переданный массив (пытается считать количество байт, равное размеру массива), возвращая число считанных байтов
- `int read(byte[], int from, int length)` - читает байты в количестве length в переданный массив, записывая их, начиная с индекса элемента массива from. Возвращает количество считанных байт
- `long skip(long byteCount)` - пропускает указанное количество байт, никуда их не сохраняя. Возвращает количество пропущенных байт
- `void mark(int numBytes)` - устанавливает метку на текущую позицию потока, которая будет находиться там, пока не будет прочитано переданное количество байт
- `void reset()` - сбрасывает указатель на поставленную ранее метку

### Классы-наследники
- `FileInputStream` - используется для чтения информации из файла. Про этот класс подробнее тут: [Ввод-вывод в файлы](io_to_file.md)
```java
InputStream inputStream = new FileInputStream("d:/a.txt");
```
- `StringBufferInputStream` - превращает строку во входной поток данных
- `ByteArrayInputStream` - можно создавать потоки для тестирования своих же задач
- `DeflatorInputStream` - принимает данные из потока и на лету распаковывает их, если они были сжаты с помощью `DeflatorOutputStream`
- `ObjectInputStream` - используется для [десериализации](../serialization.md)
- `FilterInputStream` - является родителем для нижеперечисленных потоков. В чистом виде его никто не использует
    - `DataInputStream` - обертка для InputStream, которая включает в себя методы для чтения примитивных типов из входного потока. Не используется, если во входном потоке есть строки.
    - `BufferedInputStream` - буферизированный входной поток. Работает гораздо быстрее обычного
- `PipedInputStream` - предназначен для обмена данными между программами
- `PushbackInputStream`
- `SequenceInputStream`

## OutputStream
Класс является абстрактным, хотя по сути он принадлежит к интерфейсам.

Методы:
- `void close()` - закрывает выходной поток. Предварительно очищать буфера перед вызовом этого метода не требуется
- `void flush()` - очищает все буферы вывода
- `void write(int)` - записывает 1 байт (младшие 8 бит переданного значения) в выходной поток
- `void write(byte[])` - записывает массив байтов в выходной поток
- `void write(byte[], int from, int length)` - записывает в выходной поток массив байтов длиной length, вычлененных из переданного массива, начиная с from

### Классы-наследники
- `DataOutputStream` - обертка для OutputStream, которая включает в себя методы для записи стандартный типов Java в выходной поток
- `FileOutputStream` - отправляет данные на диск. Про этот класс подробнее тут:  [Ввод-вывод в файлы](io_to_file.md)
- `BufferedOutputStream` - буферизованный выходной поток. Снижает количество вызовов к накопителю.
- `ByteArrayOutputStream` - можно создавать потоки для тестирования своих же задач
- `DeflatorOutputStream` - на лету сжимает выходные данные и отправляет их в выходной поток
- `PrintStream` - используется для вывода в консоль
- `ObjectOutputStream` - используется для [сериализации](../serialization.md)
- `FilterOutputStream`
- `PipedOutputStream` - предназначен для обмена данными между программами

## PrintStream
Класс занимается выводом информации в какой-либо поток.
Самым известным объектом этого класса является `System.out`.

Конструкторы:
- `PrintStream(OutputStream)` - передается поток, в который будет вестись запись
- `PrintStream(File)` - передается файл, в который будет вестись запись
- `PrintStream(String)` - передается в виде строки путь до файла, в который будет вестись запись

Конструкторы хороши тем, что если файла не существует, то класс сам создаст его.

Методы:
- `void print(String)` - выводит строку
- `void println(String)` - выводит строку и вставляет символ конца строки
- `PrintWriter printf(String, %, % ...)` - выводит [отформатированную](../formatting.md) строку (аналогично методу `String.format()`). 
```java
int num = 2;
System.out.printf("%s - лох, и завалил %d экзамена", "Вова", num); // Вова - лох, и завалил 2 экзамена
```
- `boolean checkError()` - проверяет наличие ошибки

**ВАЖНО**: методы не бросают исключения, вместо этого они устанавливают флаг ошибки, который проверяется с помощью метода `checkError()`

## StreamTokenizer
Класс, позволяющий разбирать поток на строки и числа

Конструкторы:
- `StreamTokenizer(Reader)`

## ByteArrayOutputStream

Является динамическим массивом и реализует класс OutputStream. Позволяет записать в поток какую-нибудь информацию, чтобы потом протестировать свою программу.

Конструкторы:
- `ByteArrayOutputStream()` - создает поток с динамическим массивом типа byte с начальным размером 32 байта
- `ByteArrayOutputStream(int size)` - создает поток с динамическим массивом типа `byte` с начальным размером, указанным в аргументе

Методы:
- `byte[] toByteArray()` - возвращает информацию, содержащуюся в потоке в виде массива байт
```java
try (FileOutputStream outputStream = new FileOutputStream(filename)){
    outputStream.write(byteArrayOutputStream.toByteArray());
} catch (IOException e){
    e.printStackTrace();
}
```
- `void writeTo(OutputStream)` - перенаправляет поток в другой выходной поток

Вот как, например, можно подменить вывод в консоль таким классом:
```java
ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); //Создаем динамический массив
PrintStream stream = new PrintStream(outputStream); //создаем адаптер к классу PrintStream
System.setOut(stream); //Устанавливаем его как текущий System.out
```

---
## К изучению
- [X] http://java-online.ru/java-outputstream.xhtml
- [X] http://java-online.ru/java-inputstream.xhtml