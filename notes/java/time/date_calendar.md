---
title: "Работа со временем"
tags:
  - time
draft: false
---

Работа с временем где бы то ни было всегда была сложной задачей из-за различий в часовых поясах, переводах на летнее и зимнее время и пр.

До Java 8 все что было в стандартной библиотеке - это классы `Date` и `Calendar`. Эти классы обладают рядом недостатков:
- Мутабельность
- Неочевидность API
- Наличие класса-двойника в пакете `java.sql`

Из-за этих недостатков вскоре набрала популярность библиотека Joda Time, которая использовалась в каждом первом проекте. В результате Oracle решили внести эту библиотеку в стандарт Java. Таким образом в Java 8 появился новый [Date Time API](datetime_api.md)

Эта заметка посвящена устаревшему API.

---
## Date

**Внимание!!! Класс уже устарел и использовать его не рекомендуется!**

Объекты Date хранят в себе время, прошедшее с 1 января 1970 г. по Гринвичу в миллисекундах. Это называется Unix-временем.

При создании объекта класса он инициализируется текущим временем.

Поля:
- hours
- minutes
- seconds
- date
- month - месяц. Нумерация месяцев начинается с нуля

### Методы
- Геттеры:
    - ~~`int getHours()`~~ - возвращает сколько сейчас часов
    - ~~`int getMinutes()`~~ - возвращает сколько сейчас минут
    - ~~`int getSeconds()`~~ - возвращает сколько сейчас секунд
    - ~~`int getDate()`~~ - возвращает день месяца
    - ~~`int getMonth()`~~ - возвращает месяц (1 - январь)
    - ~~`int getYear()`~~ - возвращает год
    - `long getTime()` - возвращает время в миллисекундах
- Сеттеры:
    - ~~`void setHours(int)`~~ - задает часы
    - ~~`void setMinutes(int)`~~ - задает минуты
    - ~~`void setSeconds(int)`~~ - задает секунды
    - ~~`void setDate(int)`~~ - задает дату
    - ~~`void setMonth(int)`~~ - задает месяц
    - ~~`void setYear(int)`~~ - задает год
- Другие методы:
    - `boolean after(Date)` - проверяет что находится позже по шкале времени и выводит true или false
    - ~~`long parse(String)`~~ - пытается преобразовать строку во время

---
## Calendar

Этот класс является улучшенной версией класса `Date`. Его единственной реализацией является `GregorianCalendar`.

Создается следующим образом:
```java
GregorianCalendar date = new GregorianCalendar(1992, Calendar.JANUARY, 3);
```

Для создания объекта типа Calendar используется метод `getInstance()`, при этом возвращается `GregorianCalendar`
```java
Calendar cal = Calendar.getInstance()
```

Поля:
- Era -
- YEAR
- MONTH
- DATE
- DAY_OF_MONTH
- HOUR - в 12 часовом формате
- HOUR_OF_DAY - в 24 часовом формате
- MINUTE
- SECOND
- ZONE_OFFSET - сдвиг часового пояса

Методы:
- `getTime()` - возвращает время целиком
- `long getTimeInMillis()` - возвращает время в миллисекундах с 1 января 1970 года.
- `get(const)` - возвращает отдельный параметр времени
- `set(const, int)` - устанавливает время (можно по отдельности)
- `void setTimeInMillis(long)` - устанавливает время в миллисекундах с 1 января 1970 года.
- `add(const, int)` - прибавление или вычитание отдельных частей времени. Пересчет остальных полей происходит автоматически
- `roll(const, int)` - прибавление или вычитание отдельных частей времени. Пересчет остальных полей не производится
```java
Calendar c = Calendar.getInstance();
c.set(2019, 8, 25, 15, 35);
c.add(c.DATE, 35); //добавили 35 дней
c.roll(c.DATE, -35); //прокрутили 35 дней назад
c.set(c.DATE, 1); //установили 1 число
```

---
## Форматирование дат

### Класс SimpleDateFormat

Используется для вывода даты в удобочитаемом виде
```java
DateFormat df = new SimpleDateFormat("dd MMM yyy GG");
System.out.println(df.format(new GregorianCalendar());
```

Паттерны времени:

|     |     |     |
| --- | --- | --- |
| Символ | Что означает | Пример |
| G   | Эра | н.э. |
| y   | год | 2012 |
| yy  | последние 2 цифра года | 12  |
| yyyy | год четырьмя цифрами | 2012 |
| M   | Номер месяца | 2   |
| MM  | Номер месяца с лидирующим нулем | 02  |
| MMM | Трехбуквенное сокращение месяца | фев |
| MMMM | Полное название месяца | Февраль |
| w   | Неделя в году | 7   |
| ww  | Неделя в году с лидирующими нулями | 07  |
| W   | Неделя в месяце без лидирующих нулей | 2   |
| WW  | Неделя в месяце с лидирующим нулем | 02  |
| D   | День в году | 38  |
| d   | День месяца | 7   |
| dd  | День месяца с лидирующими нулями | 07  |
| F   | День недели в месяце | 1   |
| FF  | День недели в месяце с лидирующими нулями | 01  |
| E   | День недели сокращенный | Вт  |
| EEEE | День недели полностью | вторник |
| a   | AM/PM - указатель | AM  |
| H   | Часы в 24-часовом формате | 6   |
| HH  | Часы в 24-часовом формате с лидирующим нулем | 06  |
| k   | Количество часов в 24-часовом формате | 18  |
| K   | Количество часов в 12-часовом формате | 6   |
| h   | Время в 12-часовом формате | 6   |
| hh  | Время в 12-часовом формате с лидирующим нулем | 06  |
| m   | Минуты | 32  |
| mm  | Минуты с лидирующим нулем | 32  |
| s   | Секунды | 11  |
| ss  | Секунды с лидирующим нулем | 11  |
| S   | Миллисекунды | 109 |
| z   | Часовой пояс сокращенно | EET |
| zzzz | Часовой пояс полно | Eastern European Time |
| Z   | Часовой пояс в формате RFC 822 | +0200 |
| '   | Символ экранирования для текста | 'Date=' |
| ''  | Кавычка | 'o''clock' |

Конструкторы:
- `SimpleDateFormat()` - используются паттерн времени и формат символов по умолчанию для текущей локализации
- `SimpleDateFormat(String pattern)` - используется заданный паттерн времени и формат символов по умолчанию для текущей локализации
- `SimpleDateFormat(String pattern, DateDormatSymbols formatSymbols)` - используется заданные паттерн времени и формат символов
- `SimpleDateFormat(String pattern, Locale locale)` - используется заданный паттерн времени и формат символов по умолчанию для заданной локализации

Методы:
- `Date parse(String)` - пытается преобразовать строку в дату, делает это в соответствии с указанным форматированием
- `String format(Date)` - возвращает дату в виде строки, отформатированной в соответствии с заданными правилами

---
## Перечисление TimeUnit

Перечисление предоставляет ряд констант со значениями в формате long:
- NANOSECONDS
- MICROSECONDS
- MILLISECONDS
- SECONDS
- MINUTES
- HOURS
- DAYS

---
## К изучению
- [ ] Статья про проблемы с временем в программировании: https://habr.com/ru/post/274811/