---
title: "Standard methods"
tags:
  - api
  - rest
draft: false
---

# Стандартные операции в API

Над большинством ресурсов, как правило, можно выполнить следующие операции:
- Get - достает существующий ресурс
- List - достает массив ресурсов
- Create - создает новый ресурс
- Update - обновляет существующий ресурс
- Delete - удаляет существующий ресурс
- Replace - заменяет весь ресурс

Ресурс не обязательно должен поддерживать все виды стандартных операций.
Если ресурс не поддерживает какую-то стандартную операцию, то желательно чтобы на неподдерживаемый HTTP метод он отвечал 405 Method Not Allowed.
Так как 404 Not Found означает отсутствие всего ресурса.

> Вопрос: Что вернет Spring Boot Web, если отправить запрос на несуществующий эндпойнт?
> Вопрос: Что вернет Spring Boot Web, если отправить запрос на существующий эндпойнт с неподдерживающимся HTTP методом?
> Ответ будет 404 Not Found или 405 Method Not Allowed?


## Идемпотентность

> В чем состоит свойство идемпотентности: в одинаковых ответах на одинаковые запросы или в неизменности состояния системы при получении нескольких одинаковых запросов?

[RestApiTutorial](https://www.restapitutorial.com/lessons/idempotency.html) и [Restfulapi.net](https://restfulapi.net/idempotent-rest-apis/) считают, что [идемпотентность](../architecture/idempotence.md) - это свойство системы не менять состояние при получении дубликата запроса.


---
## Операции
### Get
```
GET /resources/{id}
```
Возвращает ресурс по его идентификатору.

### List
```
GET /resources/
```
Возвращает коллекцию ресурсов данного типа.

> Если у пользователя, вызвавшего эндпойнт нет прав на получение части ресурсов, то нужно отдавать ему те, которые ему доступны.

> Не стоит добавлять в ответ общее число ресурсов. Если очень хочется, то лучше возвращать приблизительное количество и назвать поле `sizeEstimate`.

> Лучше не позволять клиенту API самостоятельно задавать сортировку.

> Клиенту надо дать возможность указать фильтры, но тут важно не перемудрить и сделать систему фильтрации максимально кондовой

> На метод List почти всегда нужно делать [пагинацию](./pagination.md). Добавить ее следует сразу же, потому что иначе, если изначально реализовать полную выдачу, то перейти на пагинацию, не сломав обратную совместимость будет невозможно. Пагинация может быть не нужна в редких случаях, когда метод List возвращает какой-нибудь короткий справочник, который никогда не увеличится в размерах.

### Create
```
POST /resources/
```
Создает ресурс.

> Идентификатор лучше генерировать на сервере. Если хочется дать пользователю самому указывать идентификатор, то лучше пусть он его передает в теле.

> Если ресурс создан, то он должен быть сразу доступен к запросу по Get методу.

В тех случаях, когда нельзя гарантировать мгновенное создание ресурса, лучше возвращать пользователю фьючерс - например, идентификатор, по которому он сможет запросить состояние создания ресурса.
Такое может быть полезно, если создание ресурса требует обращения к внешним сервисам.
Либо можно использовать подход с импортом.


### Update
```
PATCH /resources/{id}
```
Изменяет ресурс


### Delete
```
DELETE /resources/{id}
```
Удаляет ресурс.

> Когда удаляемый ресурс отсутствует в системе, то лучше вернуть 404 Not Found, чем 20x.

Delete является идемпотентным в любом случае.


### Replace
```
PUT /resources/{id}
```
Заменяет ресурс.

Replace может использоваться и для создания ресурса.
Но при этом должны допускаться идентификаторы, определяемые пользователем.
Например, так сделано в API Kafka Connect.

---
## Вопросы

> Нужно ли в ответе на POST, PATCH или PUT возвращать созданную/обновленную сущность?

В случае API для фронтенда это будет удобно в некоторых случаях, т.к. бывает нужно отрисовать страницу после внесения изменений. 
Например, после редактирования профиля пользователя.
Но это может быть затратным с точки зрения бэкенда: сбор полной сущности может быть куда более ресурсоёмкой операцией, чем обновление части данных в ней.
Поэтому зачастую при создании сущности возвращают только идентификатор, а при обновлении вообще ничего.
При реализации метода PUT иногда возвращают в ответе предыдущее состояние сущности, как это принято в некоторых CAS-операциях или в сигнатуре джавовой функции `Map.put()`.

Также если возвращать только идентификатор, то не нужно будет выпускать новую версию метода при добавлении необязательных полей.
Например, в API СБП в платежную ссылку много раз докидывались новые поля, из-за чего было выпущено более 7 версий метода Get, но при этом метод Create так и остался с версией 1.


---
## К изучению
- [X] Статья [The Mythology of REST](https://twirl.medium.com/the-mythology-of-rest-695eb00ba8c0) Сергея Константинова.
- [ ] Книга [The API](https://twirl.github.io/The-API-Book/index.ru.html) Сергея Константинова
