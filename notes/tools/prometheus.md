---
title: "Prometheus"
tags:
  - tool
  - database
  - monitoring
draft: false
---

# Prometheus

**Prometheus** - это набор инструментов, предназначенных для мониторинга систем.
Prometheus раскатывается на сервере с остальными приложениями и отслеживает их состояние во времени.

Ядром Prometheus является база данных, в которой данные упорядочены во времени (time series database).
Для выборки данных из этой базы используется собственный язык запросов **PromQL**.

Ключевой особенностью Prometheus является то, что он собирает метрики с сервисов самостоятельно, т.е. работает по pull модели.
Для того чтобы знать с каких сервисов нужно собирать метрики, их нужно зарегистрировать в Prometheus самостоятельно, либо использовать service discovery.

В Prometheus входят следующие инструменты:
- Prometheus server - основной компонент, включающий базу данных и http-сервер
- Клиентские библиотеки
- Push Gateway - прокладка для тех сервисов, которые умеют только пушить метрики и для короткоживущих джоб. Сервисы пушат свои метрики в Push Gatewey, откуда их потом вытягивает Prometheus server.
- Экспортеры - отдельный приложения, служащие адаптерами между Prometheus и различными популярными штуками, вроде баз данных, ОС и т.д.
- **Alert Manager** - При наступлении каких-либо важных событий (недоступность сервисов, слишком большая нагрузка на сервис и т.д.) Prometheus может пушить уведомления в Alert Manager.
  Alert Manager затем уведомляет поддержку об инцидентах каким-либо способом: сообщение в чате, СМС, электронное письмо и т.п.

Для визуализации данных из Prometheus используются сторонние инструменты.
Самый популярный сегодня инструмент - **Grafana**.


## Метрики
Метрики в Prometheus представляют собой key-value пару.
Ключом является название метрики, а значением - значение параметра на текущий момент времени.
Если нужно уточнить какие-то данные ключа, то используются лейблы.

Типы метрик:
- Счетчик - подсчитывает количество каких-либо событий. Например, количество вызовов конкретного эндпойнта
- Gauge (датчик) - показывает среднее значение какого-либо параметра за некоторый интервал времени. Например, объем занятой оперативной памяти.
- Гистрограмма - комплексная метрика, позволяющая оценить отношение чего-то к чему-то. Например, какой процент запросов выполнялся более 100 мс.
- Суммы - это гистограммы, позволяющие также оценить квантили по скользящему окну.


## Интеграция со Spring Boot
<mark>todo</mark>

---
## К изучению
- [ ] [Официальная документация](https://prometheus.io/docs/introduction/overview/)
- [X] [Github репозиторий](https://github.com/prometheus/prometheus)
- [X] [Статья про основы](https://devconnected.com/the-definitive-guide-to-prometheus-in-2019/) Prometheus
- [X] [Бодренькая статья](https://medium.com/southbridge/prometheus-monitoring-ba8fbda6e83) на русском с примером развертывания Prometheus для мониторинга состояния Ubuntu.